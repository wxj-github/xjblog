<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>XJ-Blog</title><meta name="description" content="">
    <link rel="preload" href="/xjblog/assets/style-82cbce61.css" as="style"><link rel="stylesheet" href="/xjblog/assets/style-82cbce61.css">
    <link rel="modulepreload" href="/xjblog/assets/app-6fcf50f1.js"><link rel="modulepreload" href="/xjblog/assets/webpack.html-255e041e.js"><link rel="modulepreload" href="/xjblog/assets/webpack.html-ae6cb3f0.js"><link rel="prefetch" href="/xjblog/assets/index.html-2320b9e9.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-62e263ac.js" as="script"><link rel="prefetch" href="/xjblog/assets/css.html-4c80896c.js" as="script"><link rel="prefetch" href="/xjblog/assets/flex.html-1426b188.js" as="script"><link rel="prefetch" href="/xjblog/assets/grid.html-0f729e2f.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-ded121db.js" as="script"><link rel="prefetch" href="/xjblog/assets/less.html-6a112481.js" as="script"><link rel="prefetch" href="/xjblog/assets/scope.html-dc2a0b81.js" as="script"><link rel="prefetch" href="/xjblog/assets/tailwind.html-fa555d04.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-5752af20.js" as="script"><link rel="prefetch" href="/xjblog/assets/bibao.html-aa4d620f.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-aa0f78e5.js" as="script"><link rel="prefetch" href="/xjblog/assets/js.html-e4e97a5c.js" as="script"><link rel="prefetch" href="/xjblog/assets/jstrash.html-8f9c2822.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-5672f6be.js" as="script"><link rel="prefetch" href="/xjblog/assets/centOS-mysql.html-850f04a1.js" as="script"><link rel="prefetch" href="/xjblog/assets/CentOs安装mysql5.7.html-2b49dce8.js" as="script"><link rel="prefetch" href="/xjblog/assets/del_package_quick.html-8b384235.js" as="script"><link rel="prefetch" href="/xjblog/assets/express脚手架新建项目.html-7dcab6d9.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-d3f5453d.js" as="script"><link rel="prefetch" href="/xjblog/assets/nginx.html-10c449c2.js" as="script"><link rel="prefetch" href="/xjblog/assets/node-cors解决跨域.html-08172e34.js" as="script"><link rel="prefetch" href="/xjblog/assets/package.html-e473e5a6.js" as="script"><link rel="prefetch" href="/xjblog/assets/快速打包部署.html-d358c00c.js" as="script"><link rel="prefetch" href="/xjblog/assets/antd-antdPro.html-6a7ae3a2.js" as="script"><link rel="prefetch" href="/xjblog/assets/baiduMap.html-e87d3acf.js" as="script"><link rel="prefetch" href="/xjblog/assets/hooks.html-534d4e22.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-836ae580.js" as="script"><link rel="prefetch" href="/xjblog/assets/react.html-61eaccd6.js" as="script"><link rel="prefetch" href="/xjblog/assets/g2.html-e7881cb2.js" as="script"><link rel="prefetch" href="/xjblog/assets/git.html-e83da039.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-2e88778c.js" as="script"><link rel="prefetch" href="/xjblog/assets/mongodb.html-a6bf983c.js" as="script"><link rel="prefetch" href="/xjblog/assets/network.html-3692f09e.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt-Vuex.html-8a106ffb.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt笔记.html-e8b0231b.js" as="script"><link rel="prefetch" href="/xjblog/assets/print.html-70bb765a.js" as="script"><link rel="prefetch" href="/xjblog/assets/uni-app.html-d71eedf1.js" as="script"><link rel="prefetch" href="/xjblog/assets/vuePress.html-93772d8e.js" as="script"><link rel="prefetch" href="/xjblog/assets/websocket.html-984bdb18.js" as="script"><link rel="prefetch" href="/xjblog/assets/xlsx.html-26dddaf0.js" as="script"><link rel="prefetch" href="/xjblog/assets/小程序.html-1cb9bfc3.js" as="script"><link rel="prefetch" href="/xjblog/assets/部署nuxt项目.html-8e91aa6c.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-4cdfc9c8.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-0c0b7c77.js" as="script"><link rel="prefetch" href="/xjblog/assets/defineProperty.html-4bef435b.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-d8eb0dd7.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue2.html-6b28cda9.js" as="script"><link rel="prefetch" href="/xjblog/assets/VUEX.html-2a509512.js" as="script"><link rel="prefetch" href="/xjblog/assets/doit.html-8ebb448e.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-ec34db96.js" as="script"><link rel="prefetch" href="/xjblog/assets/vite.html-6e541edd.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue3.html-71883397.js" as="script"><link rel="prefetch" href="/xjblog/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-f301dcdc.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-2dad9f7a.js" as="script"><link rel="prefetch" href="/xjblog/assets/css.html-8fd74399.js" as="script"><link rel="prefetch" href="/xjblog/assets/flex.html-5d6fc163.js" as="script"><link rel="prefetch" href="/xjblog/assets/grid.html-8c95192b.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-15e51930.js" as="script"><link rel="prefetch" href="/xjblog/assets/less.html-b163e0af.js" as="script"><link rel="prefetch" href="/xjblog/assets/scope.html-2b00b30e.js" as="script"><link rel="prefetch" href="/xjblog/assets/tailwind.html-f4608faa.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-5aa22cd3.js" as="script"><link rel="prefetch" href="/xjblog/assets/bibao.html-6e185429.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-b70b97a4.js" as="script"><link rel="prefetch" href="/xjblog/assets/js.html-4ef7cd59.js" as="script"><link rel="prefetch" href="/xjblog/assets/jstrash.html-6f938127.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-466479bb.js" as="script"><link rel="prefetch" href="/xjblog/assets/centOS-mysql.html-3533629d.js" as="script"><link rel="prefetch" href="/xjblog/assets/CentOs安装mysql5.7.html-f0b50638.js" as="script"><link rel="prefetch" href="/xjblog/assets/del_package_quick.html-82138503.js" as="script"><link rel="prefetch" href="/xjblog/assets/express脚手架新建项目.html-d0bac9df.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-fac93b33.js" as="script"><link rel="prefetch" href="/xjblog/assets/nginx.html-ad76d17a.js" as="script"><link rel="prefetch" href="/xjblog/assets/node-cors解决跨域.html-d919479a.js" as="script"><link rel="prefetch" href="/xjblog/assets/package.html-1680af4c.js" as="script"><link rel="prefetch" href="/xjblog/assets/快速打包部署.html-ba2952ce.js" as="script"><link rel="prefetch" href="/xjblog/assets/antd-antdPro.html-e38b041a.js" as="script"><link rel="prefetch" href="/xjblog/assets/baiduMap.html-38144312.js" as="script"><link rel="prefetch" href="/xjblog/assets/hooks.html-21aa2284.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-49401c60.js" as="script"><link rel="prefetch" href="/xjblog/assets/react.html-fa7d6f46.js" as="script"><link rel="prefetch" href="/xjblog/assets/g2.html-f635db4d.js" as="script"><link rel="prefetch" href="/xjblog/assets/git.html-35552097.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-58ea96b7.js" as="script"><link rel="prefetch" href="/xjblog/assets/mongodb.html-d67af31c.js" as="script"><link rel="prefetch" href="/xjblog/assets/network.html-4c136454.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt-Vuex.html-7ec793c9.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt笔记.html-46cec443.js" as="script"><link rel="prefetch" href="/xjblog/assets/print.html-07fa8979.js" as="script"><link rel="prefetch" href="/xjblog/assets/uni-app.html-67e96bd8.js" as="script"><link rel="prefetch" href="/xjblog/assets/vuePress.html-1b689bec.js" as="script"><link rel="prefetch" href="/xjblog/assets/websocket.html-eff628a7.js" as="script"><link rel="prefetch" href="/xjblog/assets/xlsx.html-75689a7d.js" as="script"><link rel="prefetch" href="/xjblog/assets/小程序.html-dcdb70c2.js" as="script"><link rel="prefetch" href="/xjblog/assets/部署nuxt项目.html-5dfe4e9c.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-ffdad007.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-481bf9b4.js" as="script"><link rel="prefetch" href="/xjblog/assets/defineProperty.html-fd1c2a46.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-73649cac.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue2.html-3bf7c541.js" as="script"><link rel="prefetch" href="/xjblog/assets/VUEX.html-94e0c565.js" as="script"><link rel="prefetch" href="/xjblog/assets/doit.html-930cb93b.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-6426e621.js" as="script"><link rel="prefetch" href="/xjblog/assets/vite.html-f25a706d.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue3.html-281128a9.js" as="script"><link rel="prefetch" href="/xjblog/assets/404.html-0040bf83.js" as="script"><link rel="prefetch" href="/xjblog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/xjblog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/xjblog/assets/index-82585c84.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/xjblog/" class=""><img class="logo" src="/xjblog/images/t.png" alt="XJ-Blog"><span class="site-name can-hide">XJ-Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/xjblog/html" class="" aria-label="Html"><!--[--><!--]--> Html <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/css" class="" aria-label="Css"><!--[--><!--]--> Css <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/js" class="" aria-label="Javascript"><!--[--><!--]--> Javascript <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/xjblog/vue2" class="" aria-label="Vue2"><!--[--><!--]--> Vue2 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/xjblog/vue3" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/xjblog/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/node" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/more" class="router-link-active" aria-label="更多"><!--[--><!--]--> 更多 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/xjblog/html" class="" aria-label="Html"><!--[--><!--]--> Html <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/css" class="" aria-label="Css"><!--[--><!--]--> Css <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/js" class="" aria-label="Javascript"><!--[--><!--]--> Javascript <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/xjblog/vue2" class="" aria-label="Vue2"><!--[--><!--]--> Vue2 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/xjblog/vue3" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/xjblog/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/node" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/more" class="router-link-active" aria-label="更多"><!--[--><!--]--> 更多 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/xjblog/more/vuePress.html" class="sidebar-item sidebar-heading" aria-label="VuePress"><!--[--><!--]--> VuePress <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/uni-app" class="sidebar-item sidebar-heading" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/小程序.md" class="sidebar-item sidebar-heading" aria-label="微信小程序"><!--[--><!--]--> 微信小程序 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/mongodb.md" class="sidebar-item sidebar-heading" aria-label="mongodb"><!--[--><!--]--> mongodb <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/nuxt笔记.md" class="sidebar-item sidebar-heading" aria-label="nuxt.js"><!--[--><!--]--> nuxt.js <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/nuxt-Vuex.md" class="sidebar-item sidebar-heading" aria-label="nuxt Vuex持久化"><!--[--><!--]--> nuxt Vuex持久化 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/部署nuxt项目.md" class="sidebar-item sidebar-heading" aria-label="部署nuxt项目"><!--[--><!--]--> 部署nuxt项目 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/network.html" class="sidebar-item sidebar-heading" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/git.html" class="sidebar-item sidebar-heading" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/print.html" class="sidebar-item sidebar-heading" aria-label="打印"><!--[--><!--]--> 打印 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/g2.html" class="sidebar-item sidebar-heading" aria-label="g2"><!--[--><!--]--> g2 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/xlsx.html" class="sidebar-item sidebar-heading" aria-label="xlsx"><!--[--><!--]--> xlsx <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用"><!--[--><!--]--> 使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#配置文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置文件"><!--[--><!--]--> 配置文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#devtool配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="devtool配置"><!--[--><!--]--> devtool配置 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#source-map-源码地图" class="router-link-active router-link-exact-active sidebar-item" aria-label="source map 源码地图"><!--[--><!--]--> source map 源码地图 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#webpack编译过程" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack编译过程"><!--[--><!--]--> webpack编译过程 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#初始化" class="router-link-active router-link-exact-active sidebar-item" aria-label="初始化"><!--[--><!--]--> 初始化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#编译" class="router-link-active router-link-exact-active sidebar-item" aria-label="编译"><!--[--><!--]--> 编译 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#输出" class="router-link-active router-link-exact-active sidebar-item" aria-label="输出"><!--[--><!--]--> 输出 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#chunk" class="router-link-active router-link-exact-active sidebar-item" aria-label="chunk"><!--[--><!--]--> chunk <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#bundle" class="router-link-active router-link-exact-active sidebar-item" aria-label="bundle"><!--[--><!--]--> bundle <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#node里的path模块" class="router-link-active router-link-exact-active sidebar-item" aria-label="Node里的path模块"><!--[--><!--]--> Node里的path模块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#出口output" class="router-link-active router-link-exact-active sidebar-item" aria-label="出口output"><!--[--><!--]--> 出口output <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#入口entry" class="router-link-active router-link-exact-active sidebar-item" aria-label="入口entry"><!--[--><!--]--> 入口entry <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#loader" class="router-link-active router-link-exact-active sidebar-item" aria-label="loader"><!--[--><!--]--> loader <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#plugin" class="router-link-active router-link-exact-active sidebar-item" aria-label="plugin"><!--[--><!--]--> plugin <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#自动清除旧的打包资源文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="自动清除旧的打包资源文件"><!--[--><!--]--> 自动清除旧的打包资源文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#自动生成页面" class="router-link-active router-link-exact-active sidebar-item" aria-label="自动生成页面"><!--[--><!--]--> 自动生成页面 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#dev-server" class="router-link-active router-link-exact-active sidebar-item" aria-label="dev server"><!--[--><!--]--> dev server <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#普通文件处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="普通文件处理"><!--[--><!--]--> 普通文件处理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#解决url-loader或file-loader产生的路径问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决url-loader或file-loader产生的路径问题"><!--[--><!--]--> 解决url-loader或file-loader产生的路径问题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#webpack内置插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack内置插件"><!--[--><!--]--> webpack内置插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#css工程化" class="router-link-active router-link-exact-active sidebar-item" aria-label="css工程化"><!--[--><!--]--> css工程化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#解决命名冲突" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决命名冲突"><!--[--><!--]--> 解决命名冲突 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#解决重复样式问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决重复样式问题"><!--[--><!--]--> 解决重复样式问题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#css-loader" class="router-link-active router-link-exact-active sidebar-item" aria-label="css-loader"><!--[--><!--]--> css-loader <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#style-loader" class="router-link-active router-link-exact-active sidebar-item" aria-label="style-loader"><!--[--><!--]--> style-loader <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#webpack中使用less" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack中使用less"><!--[--><!--]--> webpack中使用less <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#实现umijs中自动css模块化" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现umiJs中自动css模块化"><!--[--><!--]--> 实现umiJs中自动css模块化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#postcss" class="router-link-active router-link-exact-active sidebar-item" aria-label="PostCss"><!--[--><!--]--> PostCss <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#插件市场" class="router-link-active router-link-exact-active sidebar-item" aria-label="插件市场"><!--[--><!--]--> 插件市场 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#webpack中使用postcss" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack中使用PostCss"><!--[--><!--]--> webpack中使用PostCss <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#抽离css文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="抽离css文件"><!--[--><!--]--> 抽离css文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#babel" class="router-link-active router-link-exact-active sidebar-item" aria-label="babel"><!--[--><!--]--> babel <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#babel预设" class="router-link-active router-link-exact-active sidebar-item" aria-label="babel预设"><!--[--><!--]--> babel预设 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#babel插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="babel插件"><!--[--><!--]--> babel插件 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#webpack中使用babel" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack中使用babel"><!--[--><!--]--> webpack中使用babel <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#性能优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="性能优化"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#减少模块解析" class="router-link-active router-link-exact-active sidebar-item" aria-label="减少模块解析"><!--[--><!--]--> 减少模块解析 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#优化loader性能" class="router-link-active router-link-exact-active sidebar-item" aria-label="优化loader性能"><!--[--><!--]--> 优化loader性能 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#热替换hmr" class="router-link-active router-link-exact-active sidebar-item" aria-label="热替换HMR"><!--[--><!--]--> 热替换HMR <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#手动分包" class="router-link-active router-link-exact-active sidebar-item" aria-label="手动分包"><!--[--><!--]--> 手动分包 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#自动分包" class="router-link-active router-link-exact-active sidebar-item" aria-label="自动分包"><!--[--><!--]--> 自动分包 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#单模块体积压缩" class="router-link-active router-link-exact-active sidebar-item" aria-label="单模块体积压缩"><!--[--><!--]--> 单模块体积压缩 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#tree-shaking" class="router-link-active router-link-exact-active sidebar-item" aria-label="tree shaking"><!--[--><!--]--> tree shaking <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#懒加载" class="router-link-active router-link-exact-active sidebar-item" aria-label="懒加载"><!--[--><!--]--> 懒加载 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#eslint" class="router-link-active router-link-exact-active sidebar-item" aria-label="ESLint"><!--[--><!--]--> ESLint <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#bundle-analyzer" class="router-link-active router-link-exact-active sidebar-item" aria-label="bundle analyzer"><!--[--><!--]--> bundle analyzer <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#gzip" class="router-link-active router-link-exact-active sidebar-item" aria-label="gzip"><!--[--><!--]--> gzip <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#npm-run-all" class="router-link-active router-link-exact-active sidebar-item" aria-label="npm-run-all"><!--[--><!--]--> npm-run-all <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#scope-hoisting" class="router-link-active router-link-exact-active sidebar-item" aria-label="scope hoisting"><!--[--><!--]--> scope hoisting <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#experiments实验特性" class="router-link-active router-link-exact-active sidebar-item" aria-label="experiments实验特性"><!--[--><!--]--> experiments实验特性 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/webpack.html#toplevelawait" class="router-link-active router-link-exact-active sidebar-item" aria-label="topLevelAwait"><!--[--><!--]--> topLevelAwait <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/webpack.html#模块联邦" class="router-link-active router-link-exact-active sidebar-item" aria-label="模块联邦"><!--[--><!--]--> 模块联邦 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/webpack.html#为什么vite比webpack快" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么vite比webpack快"><!--[--><!--]--> 为什么vite比webpack快 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/xjblog/more/websocket.html" class="sidebar-item sidebar-heading" aria-label="websocket"><!--[--><!--]--> websocket <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><p>webpack是基于模块化的打包（构建）工具，它把一切视为模块。</p><p>通过一个开发时态的入口模块为起点，分析出所有的依赖关系，然后经过一系列的过程（压缩、合并），最终生成运行时态的文件。</p><p>特点：</p><ul><li>由于webpack在构建的过程中需要读取文件，因此它是运行在node环境中</li><li>webpack在构建过程中要分析依赖关系，方式是通过模块化导入语句进行分析，它支持各种模块化标准，包括但不限于CommonJS、ES6 Module</li></ul><p>本文档是测试时是基础webpack5的，看下面安装版本可知。但记录原理方面基本是Webpack4的内容，而5会比4优化了一些内容，但webpack的核心原理是不变的。</p><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h2><p>webpack通过npm安装，提供了两个包：</p><ul><li>webpack：核心包，包含了webpack构建过程中要用到的所有api</li><li>webpack-cli：提供一个简单的cli命令，它调用webpack核心包的api来完成构建过程</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> webpack webpack-cli   <span class="token comment"># 此时版本分别是5.89.0 5.1.4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> webpack <span class="token parameter variable">--mode</span><span class="token operator">=</span>production
<span class="token comment"># --mode=xxx 配置打包环境 production / development</span>
<span class="token comment"># 也可以在package.json的script中配置运行指令 &quot;build&quot;:&quot;webpack --mode=production&quot;      pnpm run build</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认情况下，webpack会以**./src/index.js<strong>作为入口文件分析依赖关系，打包到</strong>./dist/main.js**文件中</p><p>通过--mode选项可以控制webpack的打包结果的运行环境</p><p>entry可以有多个入口文件，用数组进行配置。一般单页面应用都是只有一个入口文件</p><h2 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h2><p>默认情况下，webpack会读取webpack.config.js作为配置文件，也可以通过cli参数--config来指定某个配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> webpack <span class="token parameter variable">--config</span> test.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>配置文件中通过CommonJs模块导出一个对象，对象中各种属性对应不同的webpack配置</p><p><strong>注意：配置文件中的代码，必须是有效的node代码</strong></p><p>当命令行参数与配置文件的配置出现冲突，以命令行参数为准</p><p><strong>基本配置：</strong></p><ol><li>mode：指定编译结果代码的运行环境，取值为<strong>development</strong>或<strong>production</strong></li><li>entry：指定入口文件</li><li>output：指定编译结果文件</li><li>loader：加载器，转换代码</li><li>plugin：插件</li></ol><p>其他一些配置：</p><ul><li><p><strong>context</strong>：配置的是配置文件执行的位置，会影响entry、loaders中的相对路径</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">context</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>  <span class="token comment">//entry、loaders中./ 就是该配置项的位置 .如果没有配置，./则取决于cwd（文件当前执行路径，上面path模块中有所提及）</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>output里的<strong>library</strong>,<strong>libraryTarget</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span><span class="token string">&#39;abc&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//这个意思就是最终打包文件里，打包结果（入口文件导出的结果）会复制给变量abc(全局变量可访问到)</span>
    <span class="token comment">//比如jquery，最后就导出了个$变量</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span><span class="token string">&#39;var&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 控制如何暴露这个变量，默认为var、还有widnow、this、global、commonjs等</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>target</strong>：构建的目标环境</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">target</span><span class="token operator">:</span><span class="token string">&#39;web&#39;</span> <span class="token comment">//默认值。打包后运行在web环境中.还有node等.</span>
<span class="token comment">//影响webpack解析模块，比如在入口文件rquire(&#39;fs&#39;),如果是web，它不会把它当作是node的内置模块来解析，而是去node_modules里找依赖</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>resolve：</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//默认只有node_modules，表示模块查找位置顺序，按数组顺序查找，没啥太大用处</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;.json&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 这个配置就是可以省略文件后缀名的原理。require(&#39;./a&#39;) 查找a模块时，自动补全.js，找不到就找.json，再没有就报错找不到模块.</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span><span class="token punctuation">{</span>  <span class="token comment">//路径别名</span>
    <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// @/a/b.js 就是 配置文件目录/src/a/b.js</span>
    <span class="token string-property property">&quot;_&quot;</span><span class="token operator">:</span>__dirname
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>externals</strong>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">externals</span><span class="token operator">:</span><span class="token punctuation">{</span>  <span class="token comment">//告诉webpack遇到哪个包，最终打包结果里不想要以下模块，适合第三方库自己cdn引入</span>
    <span class="token literal-property property">jquery</span><span class="token operator">:</span><span class="token string">&quot;$&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//项目使用可以不require(&#39;jquery&#39;)，直接使用配置的 value</span>
    <span class="token literal-property property">lodash</span><span class="token operator">:</span><span class="token string">&quot;_&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>stats</strong>：<a href="https://www.webpackjs.com/configuration/stats/" target="_blank" rel="noopener noreferrer">控制构建过程中控制台输出的内容<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><p>项目根目录下新建webpack.config.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>    <span class="token comment">//入口文件；这是下面的形式的简写</span>
  <span class="token comment">//   entry: {</span>
  <span class="token comment">//     main: &quot;./src/index.js&quot;,</span>
  <span class="token comment">//   },</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">//webpack如果发现配置文件导出的是个函数，会给它传入env参数来区分环境</span>
    <span class="token comment">//但env里面的值需要通过webpack命令传入参数,如</span>
    <span class="token comment">// webpack --env.abc=1</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="devtool配置" tabindex="-1"><a class="header-anchor" href="#devtool配置" aria-hidden="true">#</a> devtool配置</h2><h3 id="source-map-源码地图" tabindex="-1"><a class="header-anchor" href="#source-map-源码地图" aria-hidden="true">#</a> source map 源码地图</h3><p>前端真正在项目中运行的是源代码经过合并、压缩等操作后转换的代码，这就给调试带来了困难，因为当运行发生的错误的时候，我们更希望看到源代码出错的位置，而不是转换后的代码。</p><p>为了解决这一问题，谷歌浏览器率先支持source map，配置中不仅记录了所有源码内容，还记录了和转换后的代码的对应关系。所以当发生错误的时候，浏览器就能准确定位到发生错误的源代码位置。</p><ul><li>source map应在开发环境中使用，作为一种调试手段</li><li>source map不应该在生产环境中使用，source map的文件一般较大，不仅会导致额外的网络传输（浏览器发现有source map的时候就会去请求），还容易暴露原始代码</li></ul><p>webpack.config.js:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>值：</p><ul><li><strong>none</strong> ： 生产环境默认配置（省略devtool配置,填了会报错），即没有source map (构建速度和重新构建速度（--watch）都很快)</li><li><strong>eval</strong> : 开发环境默认配置 (构建速度和重新构建速度都很快) 每个模块都使用eval执行，并且都有 //@ sourceURL(它会帮你形成这个js文件放到浏览器source中，并把源代码放进去,代码可以打断点)。主要缺点是映射的是转换后的代码，不能正确的显示行数</li><li><strong>eval-source-map</strong>: 每个模块使用eval执行，并且source map转换为<strong>DataUrl</strong>后添加到eval()中（相当于把source map编码后放入到打包后的文件中），初始化source map比较慢，重新构建时比较快。行数能正确映射。<strong>(开发环境调试最佳实践)</strong></li><li><strong>eva-cheap-source-map</strong>: 类似eval-source-map，没有生成列映射，只是映射行数，构建和重构速度比eval-source-map快，但没它位置精准</li><li><strong>source-map</strong> :整个source map作为一个单独的文件生成,它为bundle添加了一个引用注释(<strong>//@ sourceMappingURL</strong>)。构建速度慢。（你应该将你的服务器配置为：不允许普通用户访问source map文件）</li><li><strong>hidden-source-map</strong> : 与source-map类似，但不会生成引用注释，所以浏览器不会暴露你的source-map，同样开发人员也无法看到。但只要在浏览器找到报错文件，右键就可以看到Add source Map的选项，填写url(本地文件路径，注意用 <strong>/</strong> )即可看到源代码</li><li><strong>inline-source-map</strong> : 也是通过<strong>dataUrl</strong>的方式内联在打包后的文件，而不是单独的map文件</li></ul><p>devtool的值其实是按照一定的顺序组合而成：</p><ul><li><p>eval:上面已有提及</p></li><li><p>cheap：上面已有提及，只映射到源代码的某一行，不精准到列，可提升sourcemap生成速度</p></li><li><p>source-map：生成source-map文件，可以搭配inline、hidden</p></li><li><p>nosources：不生成sourceContent内容，可以减少sourcemap的文件大小.(<strong>sourcemap 里是有 sourceContent 部分的，也就是直接把源码贴在这里,如果在浏览器查看，能够定位到报错。但是不会在浏览器显示源码内容（nosources - 没有源码）。其实我感觉和hidden很相似，</strong></p><p><strong>区别一是hidden会给你生成带sourceContent的map文件，nosources没有。</strong></p><p><strong>二是报错时hidden显示的不是精准位置，需要手动关联map文件，而nosources报错位置精准</strong>)</p></li><li><p>module：sourcemap生成时会关联每一步loader生成的sourcemap(即代码可能会经过多个loader处理，也就是会产生多个sourcemap)，配合sourcemap-loader可映射回最初的源码。<a href="https://juejin.cn/post/7136049758837145630?searchId=202401232333504338AA212FDFC5AFE590#heading-4" target="_blank" rel="noopener noreferrer">(这个属性感觉基本用不到)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><p>理解了这些基础配置项，根据 <strong>^(inline-|hidden-|eval-)?(nosources-)?(cheap-(module-)?)?source-map$</strong> 的规律来进行组合</p><h2 id="webpack编译过程" tabindex="-1"><a class="header-anchor" href="#webpack编译过程" aria-hidden="true">#</a> webpack编译过程</h2><h3 id="初始化" tabindex="-1"><a class="header-anchor" href="#初始化" aria-hidden="true">#</a> 初始化</h3><p>此阶段，webpack会将<strong>cli参数</strong>、<strong>配置文件</strong>、<strong>默认配置</strong>进行融合，形成一个最终的配置对象（此处理过程依托一个第三方库yargs）</p><p>初始化阶段主要用于产生一个最终的配置。</p><h3 id="编译" tabindex="-1"><a class="header-anchor" href="#编译" aria-hidden="true">#</a> 编译</h3><ol><li><p><strong>创建chunk</strong></p><p>chunk是webpack在内部构建过程中的一个概念，译为<strong>块</strong>。它表示通过某个入口找到的所有依赖的统称。</p><p>根据入口模块（默认为./src/index.js）创建一个chunk</p><p>每个chunk都至少有两个属性：</p><ul><li>name：默认为main</li><li>id：唯一编号，开发环境和name相同，生产环境是一个数字，从0开始</li></ul></li><li><p><strong>构建所有依赖模块</strong></p><p>假设只有入口文件main.js,main.js依赖a.js、b.js。a.js又依赖b.js</p><p>从入口文件开始递归，<strong>先检查记录</strong>中是否已加载main.js，没有记录，则开始读取main.js的文件内容，<strong>内容被loaders处理</strong>，再进行<strong>语法分析转换成AST抽象语法树</strong>来分析并<strong>记录依赖数组</strong> 【./src/a.js，./src/b.js】(完整相对路径)，然后<strong>替换依赖函数</strong>(并非改动文件内容，在内存中读取替换)，类似这个格式__webpack_require(&#39;&#39;./src/a.js&#39;),把转换后的代码和当前分析的模块id一同记录起来（开头检查的记录中，现在就多了{ id: &#39;./src/main.js&#39;, value:转换后的代码}）</p><p>然后<strong>循环依赖数组</strong>，先<strong>检查记录</strong>中是否已加载a.js，没有则开始读取a.js的文件内容，进行依赖分析【./src/b.js】，然后替换依赖函数并记录。此时<strong>记录</strong>内容:</p><table><thead><tr><th style="text-align:center;">模块id</th><th style="text-align:center;">转换后的代码</th></tr></thead><tbody><tr><td style="text-align:center;">./src/main.js</td><td style="text-align:center;">xxxxx</td></tr><tr><td style="text-align:center;">./src/a.js</td><td style="text-align:center;">xxxxx</td></tr></tbody></table><p>然后<strong>循环a的依赖数组</strong>，<strong>检查记录</strong>中是否已加载b.js，没有则开始读取b.js的文件内容，进行依赖分析【无其他依赖】，直接记录。此时<strong>记录</strong>内容:</p><table><thead><tr><th style="text-align:center;">模块id</th><th style="text-align:center;">转换后的代码</th></tr></thead><tbody><tr><td style="text-align:center;">./src/main.js</td><td style="text-align:center;">xxxxx</td></tr><tr><td style="text-align:center;">./src/a.js</td><td style="text-align:center;">xxxxx</td></tr><tr><td style="text-align:center;">./src/b.js</td><td style="text-align:center;">xxxxx</td></tr></tbody></table><p>至此a的依赖数组已经分析完，再回到main.js的依赖数组，检查记录中是否有b.js，发现有就不会加载。</p><p>然后整个模块依赖就分析完毕</p></li><li><p>产生chunk assets</p><p>在第二步完成后，chunk中会产生一个模块列表，列表中包含了模块id和转换后的代码。</p><p>接下来webpack会根据配置位chunk生成一个<strong>资源列表</strong>，即chunk assets，可以理解为是生成到最终文件的文件名和文件内容，类似：</p><table><thead><tr><th style="text-align:center;">文件名</th><th style="text-align:center;">文件内容</th></tr></thead><tbody><tr><td style="text-align:center;">./dist/main.js</td><td style="text-align:center;">xxxxxxx</td></tr><tr><td style="text-align:center;">./dist/main.js.map</td><td style="text-align:center;">xxxxxxxx</td></tr></tbody></table><p>chunk hash是根据所有chunk assets的内容生成的hash字符串，原始内容不变，hash字符串就不会变</p></li><li><p>合并chunk assets</p><p>将多个chunk的assets合并到一起，并产生一个总的hash</p></li></ol><h3 id="输出" tabindex="-1"><a class="header-anchor" href="#输出" aria-hidden="true">#</a> 输出</h3><p>webpack利用node的fs模块，根据编译产生的总的assets，生成相应的文件</p><h2 id="chunk" tabindex="-1"><a class="header-anchor" href="#chunk" aria-hidden="true">#</a> chunk</h2><p>webpack内部构建模块的块，一个chunk中包含多个模块，可以认为一个chunk由一个入口文件分析得来</p><h2 id="bundle" tabindex="-1"><a class="header-anchor" href="#bundle" aria-hidden="true">#</a> bundle</h2><p>chunk构建好模块后会生成chunk的资源清单，清单的每一项就是一个bundle，可以认为bundle就是最终生成的文件</p><h2 id="node里的path模块" tabindex="-1"><a class="header-anchor" href="#node里的path模块" aria-hidden="true">#</a> Node里的path模块</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
   1、在模块化代码中，比如require(&#39;./&#39;),表示当前js文件所在的目录
   2、在路径处理和文件操作中，&quot;./&quot;表示node运行目录。比如project文件夹下的src有个test.js和a.txt，在project文件夹终端中运行test.js

test.js：
	let fs = require(&#39;fs&#39;)
    fs.readFile(&quot;./a.txt&quot;, function (err, data) {
      if (err) {
        console.log(err);
        return console.log(&quot;读取失败&quot;);
      }
      console.log(data.toString());
    });

会报错找不到文件，因为它读取的目录是G:\xxx\project\a.txt
只有cd到src目录中运行test.js才能正确读取文件,所以在node非模块化代码中应尽量减少使用相对路径，而要使用node的path模块提供的api或变量

fs.readFile(path.resolve(__dirname,&#39;a.txt&#39;))

	__dirname在所有情况下都表示 执行的js所在文件夹的绝对路径
	__filename 执行的js文件的绝对路径
	path.resolve()用于拼接参数形成绝对路径
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="出口output" tabindex="-1"><a class="header-anchor" href="#出口output" aria-hidden="true">#</a> 出口output</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span>  <span class="token punctuation">,</span><span class="token comment">//手动必须配置一个绝对路径，表示打包后资源放置的文件夹，默认是项目根目录的dist</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span>  <span class="token string">&#39;bundle.js&#39;</span><span class="token punctuation">,</span><span class="token comment">//配置合并的js文件的规则,字符串就是静态写死</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="入口entry" tabindex="-1"><a class="header-anchor" href="#入口entry" aria-hidden="true">#</a> 入口entry</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span> <span class="token comment">//key表示chunk的名字，value表示chunk的入口文件。可以配置多个chunk，只有一个chunk，可以写成字符串</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span><span class="token comment">//默认情况下，它就是这么一个写法的效果。</span>
        <span class="token literal-property property">a</span><span class="token operator">:</span><span class="token string">&#39;./src/a.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">b</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;./src/a.js&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;./src/b.js&#39;</span><span class="token punctuation">]</span>  <span class="token comment">//一个chunk可以有多个入口文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span>  <span class="token punctuation">,</span>
       <span class="token comment">// filename:  &#39;bundle.js&#39;,//如果配置了多个入口文件还这么写就会报错，因为多个chunk编译后输出了同一个文件名</span>
        
        <span class="token comment">/*
        	应改为动态规则 
        	name即为entry里配置的chunkname、
        	hash为总chunk的hash(后面接个:x，表示取hash前几位),主要是防止浏览器访问到旧资源的缓存
        	chunkhash为单独hash，只有该chunk内容变动，hash才会改变。推荐使用
        	contenthash,单个文件内容生成的hash
        */</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name]-[hash:6].js&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="loader" tabindex="-1"><a class="header-anchor" href="#loader" aria-hidden="true">#</a> loader</h2><p>webpack做的事，仅仅是分析出各种模块的依赖关系，然后形成资源列表，最终打包生成到指定的文件中。</p><p>更多的功能需要借助webpack loaders和webpack plugins完成。</p><p><strong>loader本质是一个函数，它的作用是将某个源码字符串转换成另一个源码字符串返回。</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;loader-utils&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">sourceCode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">//源代码读取出来，传递给loader进行调用，然后再去转换成抽象语法树进行依赖分析</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token comment">//传入的options在this中，但不好获取，可借助第三方库。这里的this是loader context，提供了一些方法和属性</span>
    loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取传入的options</span>
	<span class="token keyword">return</span> <span class="token string">&#39;最终代码&#39;</span>
<span class="token punctuation">}</span>

loader<span class="token punctuation">.</span>raw<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//设置raw为true后，webpack就会把文件原始数据给你返回，否则就是字符串。比如处理图片内容时，为true时，sourceCode是二进制数据，不设置时，就是字符串乱码</span>

<span class="token comment">// this.emitFile(&#39;name&#39;,fileContent)  //最终生成一个资源文件</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span>loader<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>当前模块是否满足某个规则</li><li>是：读取规则中对应的loaders数组。loaders数组，<strong>从右往左执行loaders</strong></li><li>否：不做任何改动，转换成抽象语法树分析依赖</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//针对模块的配置，有rules、noParse(是否不要解析某个模块)等</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">//rules的匹配顺序和loader的执行顺序都是从右往左（从下往上）</span>
      <span class="token comment">//模块匹配规则，可以存在多个规则</span>
      <span class="token punctuation">{</span>       <span class="token comment">//每个规则是一个对象</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">//匹配的模块正则</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>   <span class="token comment">//匹配到后应用的规则模块</span>
              <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;模块路径&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                  <span class="token comment">//向对应的loader传递额外的参数</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">&#39;xxx?a=1&amp;b=2&#39;</span>  <span class="token comment">//还可以简写成字符串，参数可以用query参数方式传入</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token literal-property property">noParse</span><span class="token operator">:</span>  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"> </span><span class="token regex-delimiter">/</span></span>   <span class="token comment">//匹配正则，对匹配到的模块不做任何处理，读取内容后直接原封不动打包. </span>
      <span class="token comment">//通常用它来忽略那些大型的单模块库，以提高构建性能，比如jquery（会发现node_modules里jquery的包其实已经是构建好的单文件模块，就没必要让它再参与一次构建）</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="plugin" tabindex="-1"><a class="header-anchor" href="#plugin" aria-hidden="true">#</a> plugin</h2><p>在 webpack 运行的生命周期中会广播出许多事件，<code>Plugin</code> 可以监听这些事件，在合适的时机通过 webpack 提供的 api 改变输出结果</p><p>loader的功能定位是转换代码，而一些其他操作难以使用loader完成，比如：</p><ul><li>当webpack生成文件时，顺便多生成一个说明描述文件</li><li>当webpack编译启动时，控制台输出一句话表示webpack启动了</li></ul><p>这种类似的功能需要把功能嵌入到webpack的编译流程中，是依托于plugin的</p><p>plugin的本质是一个带有apply方法的对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> plugin <span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token function-variable function">apply</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//通常我们会将该对象携程构造函数的模式</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">{</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//在这里注册事件，类似于window.onload</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>监听事件名<span class="token punctuation">.</span><span class="token function">事件类型</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//事件处理函数</span>
            
            compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>监听事件名<span class="token punctuation">.</span><span class="token function">事件类型</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//compilation也有监听事件</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>webpack.config.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> MyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./plugins/myplugin.js&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugin</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>compiler</strong>对象是在<strong>初始化阶段构建的</strong>，整个webpack打包期间只有一个compiler对象，后续完成打包工作的是compiler对象内部创建的compilation(可能会有多个，监听变化重新打包时会重新创建)</p><p>apply方法会在<strong>创建好compiler对象后调用</strong>（在文件变化时，不会重复初始化阶段，因此重新打包apply方法不会重新执行），并向方法传入一个compiler对象。</p><p>compiler对象提供大量的钩子函数（hooks，可以理解为事件），plugin的开发者可以注册这些钩子函数，参与webpack编译和生成</p><p><a href="https://webpack.docschina.org/api/compiler-hooks/#root" target="_blank" rel="noopener noreferrer">钩子事件<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>事件类型：</strong></p><p>这一部分使用的是Tapable Api，是一个专门用于钩子函数监听的库</p><p>它提供了一些事件类型：</p><ul><li><p>tap：注册一个同步的钩子函数，函数运行完毕则表示事件处理结束</p></li><li><p>tapAsync：注册一个基于回调的异步的钩子函数，函数通过调用一个回调表示事件处理结束</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">{</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>监听事件名<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//调用该回调，表示事件处理结束</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>tapPromise：注册一个基于promise的异步的钩子函数，函数通过返回的promise进入已决状态表示事件处理结束</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">{</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>监听事件名<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="自动清除旧的打包资源文件" tabindex="-1"><a class="header-anchor" href="#自动清除旧的打包资源文件" aria-hidden="true">#</a> 自动清除旧的打包资源文件</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> clean-webpack-plugin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;clean-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;script/[name]-[hash:6].js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./dist&#39;</span><span class="token punctuation">)</span>  <span class="token comment">//漏了可能会删除失败</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpackConfig<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>webpack5中该功能已开箱即用</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">clean</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 在生成文件之前清空 output 目录</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自动生成页面" tabindex="-1"><a class="header-anchor" href="#自动生成页面" aria-hidden="true">#</a> 自动生成页面</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> html-webpack-plugin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;html-webpack-plugin&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   <span class="token comment">//要是想多生成几个页面，重复调用即可</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">&#39;./public/index.html&#39;</span><span class="token punctuation">,</span> <span class="token comment">//还可以使用自己的模板.如果有多个入口文件，则都会引入最终的js文件</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">//可以用该属性配置页面引入哪些chunks</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="dev-server" tabindex="-1"><a class="header-anchor" href="#dev-server" aria-hidden="true">#</a> dev server</h2><p>开发阶段的操作流程：</p><ul><li>编写代码</li><li>控制台运行命令打包</li><li>查看页面效果</li><li>继续编写代码重复第二步</li></ul><p>我们往往希望把最终生成的代码和页面部署到服务器上来模拟真实环境，为了解决这个问题，webpack官方制作了一个单独的库：webpack-dev-server</p><p>它既不是loader也不是plugin</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> webpack-dev-server
<span class="token function">pnpm</span> run webpack-dev-server <span class="token comment">#执行命令</span>

<span class="token comment"># webpack5中可以直接 webpack server 启动</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把package.json里script的启动命令换成webpack-dev-server</p><p>webpack-dev-server命令几乎支持所有的webpack命令参数，可以把它当作webpack命令使用。</p><p>这个命令是专门为开发阶段服务的，真正部署的时候还是得使用webpack命令</p><p>当我们执行webpack-dev-server命令时，它做了以下操作：</p><ol><li>内部执行webpack命令，传递命令参数</li><li>开启watch</li><li>注册hooks：类似于plugin，webpack-dev-server会向webpack中注册一些钩子函数，主要功能是 <ol><li>将资源列表（assets）保存起来</li><li>禁止webpack输出文件</li></ol></li><li>用express开启一个服务器，监听某个端口，当请求到达后，返回相应的资源内容（并没有生成真正的文件）</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">devServer</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">port</span><span class="token operator">:</span><span class="token number">8080</span><span class="token punctuation">,</span>
        <span class="token literal-property property">open</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//启动后自动打开浏览器,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span><span class="token string">&#39;index.html&#39;</span> <span class="token comment">//默认为index.html,即访问localhost:8080时，它会自动寻找localhost:8080/index.html</span>
        <span class="token literal-property property">proxy</span><span class="token operator">:</span><span class="token punctuation">{</span>  <span class="token comment">//配置代理</span>
            <span class="token string-property property">&#39;/api&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:3000&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//更改请求头中的host和origin</span>
                <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;^/api&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">stats</span><span class="token operator">:</span><span class="token punctuation">{</span> <span class="token comment">//控制输出信息</span>
            <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://webpack.docschina.org/configuration/dev-server/" target="_blank" rel="noopener noreferrer">其他具体配置<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="普通文件处理" tabindex="-1"><a class="header-anchor" href="#普通文件处理" aria-hidden="true">#</a> 普通文件处理</h2><p>在 webpack4 中，针对资源型文件我们通常使用 file-loader、μrl-loader、raw-loader进行处理</p><p>由于大部分前端项目都会用到资源型文件，因此<strong>webpack5原生支持了资源型模块</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
    	<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name]-[hash:6].js&#39;</span><span class="token punctuation">,</span>
    	<span class="token literal-property property">path</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">assetModuleFilename</span><span class="token operator">:</span><span class="token string">&#39;assets/[hash:5][ext]&#39;</span><span class="token punctuation">,</span><span class="token comment">//+++ 自定义资源文件保存路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.png</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset/resource&#39;</span><span class="token punctuation">,</span><span class="token comment">//作用类似于file-loader</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jpg</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset/resource&#39;</span><span class="token punctuation">,</span><span class="token comment">//作用类似于url-loader文件大小不足的场景</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.txt</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset/source&#39;</span><span class="token punctuation">,</span><span class="token comment">//作用类似于raw-loader，读取文件原始内容</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.gif</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset&#39;</span><span class="token punctuation">,</span><span class="token comment">// 类似于url-loader,根据文件大小分情况</span>
                <span class="token literal-property property">generator</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">&#39;gif/[hash:5][ext]&#39;</span><span class="token comment">//会覆盖assetModuleFilename</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">dataUrlCondition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token comment">// 4kb以下使用data-url</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># pnpm i -D file-loader # file-loader能够在import/require导入一个文件时，将导入结果变成一个url地址，并生成一个文件到输出目录里</span>
<span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> url-loader <span class="token comment"># url-loader是将依赖的文件转换未base64字符串进行导出</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> png <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@/src/assets/logo.png&#39;</span><span class="token punctuation">)</span><span class="token comment">//希望导入的模块结果是一个可用的资源路径，但这种情况下肯定会报错，就需要loader处理</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src<span class="token operator">=</span>png<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">//rules的匹配顺序和loader的执行顺序都是从右往左（从下往上）</span>
      <span class="token comment">//模块匹配规则，可以存在多个规则</span>
      <span class="token punctuation">{</span>       <span class="token comment">//每个规则是一个对象</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png)|(gif)|(jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">//匹配的模块正则</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>   
             <span class="token comment">// {</span>
             <span class="token comment">//   loader:&#39;file-loader&#39;,</span>
             <span class="token comment">//   options:{</span>
                  <span class="token comment">//向对应的loader传递额外的参数</span>
             <span class="token comment">//     name:&quot;[name].[hash:5].[ext]&quot;</span>
             <span class="token comment">//   }</span>
             <span class="token comment">// },</span>
              <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">//只要文件不超过8*1024字节，则使用base64编码,否则交给file-loader（url-loader内部会使用file-loader,不需要再单独配置file-loader）</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;[name].[hash:5].[ext]&quot;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="解决url-loader或file-loader产生的路径问题" tabindex="-1"><a class="header-anchor" href="#解决url-loader或file-loader产生的路径问题" aria-hidden="true">#</a> 解决url-loader或file-loader产生的路径问题</h3><p>比如图片资源最终打包在dist/img/webpack.png，而在 http://localhost:8080/html/index.html的js使用该资源路径，它最终生成的路径<strong>img/webpack.png相对路径</strong>就会变成 http://localhost:8080/html/img/webpack.png</p><p>造成这个问题的根本原因是模块中的路径来自于某个loader或plugin，当产生路径时，loader或plugin只有相对于dist目录的路径，并不知道该路径将在哪个资源中使用，从而无法确定最终正确的路径，需要依靠webpack的配置publicPath解决,在output中配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span> 
        <span class="token literal-property property">main</span><span class="token operator">:</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span>  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span>  <span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;script/[name]-[hash:6].js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">publicPath</span><span class="token operator">:</span><span class="token string">&#39;/&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经这样配置后，url-loader就会使用这个publicPath字符串，拼接成**/img/webpack.png**（<strong>绝对路径</strong>，最终就变成 http://localhost:8080/img/webpack.png ）</p><h2 id="webpack内置插件" tabindex="-1"><a class="header-anchor" href="#webpack内置插件" aria-hidden="true">#</a> webpack内置插件</h2><p>所有的webpack内置插件都作为webpack的静态属性存在，使用下面的方式即可创建一个插件对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span></span><span class="token function">插件名</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="css工程化" tabindex="-1"><a class="header-anchor" href="#css工程化" aria-hidden="true">#</a> css工程化</h2><p>css工程化容易遇到的问题</p><ul><li>类名冲突：选择器写的短容易冲突，写的长不易编写、阅读维护、压缩</li><li>重复样式：当重复样式值多次出现，如果主色调要维护就极其麻烦</li><li>css文件细分问题：在开发时，我们希望css文件尽可能的细分，把公共部分抽离出来。而在生产环境，我们又希望和js文件一样越少越好。</li></ul><h3 id="解决命名冲突" tabindex="-1"><a class="header-anchor" href="#解决命名冲突" aria-hidden="true">#</a> 解决命名冲突</h3><p><strong>提供命名标准来解决冲突</strong>，常见的标准有：</p><ul><li>BEM: Block Element Modifier，一个类名包含着三个部分，例如banner__dot_selected,表示轮播图中处于选中状态的圆点 <ul><li>Block：页面中的大区域，表示最顶级的部分，如轮播图banner、布局layout、文章article</li><li>element：区域中的组成部分，如轮播中的图片banner__img,布局中的头部layout__header,</li><li>modifier：可选，通常表示状态，如展开expand，选中selected</li></ul></li><li>OOCSS</li><li>AMCSS</li><li>SMACSS</li></ul><p><strong>css in js</strong></p><p>用js对象来表示样式，然后把样式直接应用到元素的style中。这样依赖css变成了一个个对象，就可以完全利用到js的语言优势：</p><ul><li>通过一个函数返回一个样式对象</li><li>把公共的样式提取到公共模块中返回</li><li>应用js的各种特性操作对象，比如：混合、提取、拆分</li></ul><p><strong>css module</strong></p><p>css-loader配置项modules设为true，即可把类名转换为<strong>路径+类名形成的hash</strong>，就不会产生冲突，</p><p>再配合style-loader,经过下面css-loader的说明可以知道经css-loader处理后会导出很多东西，而再经style-loader处理，只会导出一个对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&#39;@/css/index.css&#39;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;styles&#39;</span><span class="token punctuation">,</span>styles<span class="token punctuation">)</span>  <span class="token comment">//最终styles导出的是原类名和hash的对应对象  {c1:&#39;xxxadfs&#39;,c2:&#39;sdfwefw&#39;}</span>

<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;div1&#39;</span><span class="token punctuation">)</span>
div<span class="token punctuation">.</span>className<span class="token operator">=</span> styles<span class="token punctuation">.</span>c1<span class="token punctuation">;</span>

<span class="token comment">//在umi框架jsx中偶尔会直接import &#39;@/css/index.less&#39;，经测试发现编译后类名并没有变化，所以可能只有import时用变量接受才会开启模块化</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">:global(.main)</span><span class="token punctuation">{</span>    <span class="token comment">/*这是css module的语法，不回对这种代码类名进行转换*/</span>
    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="解决重复样式问题" tabindex="-1"><a class="header-anchor" href="#解决重复样式问题" aria-hidden="true">#</a> 解决重复样式问题</h3><p><strong>css in js</strong></p><p>虽然可以利用js语言解决重复样式值的问题，但太过激进，需要开发者一段时间适应</p><p><strong>预编译器</strong></p><p>第三方搞出一套css的进化版来解决这个问题，它支持变量、函数等高级语法，然后通过编译器将其编译成正常的css</p><p>常见的预编译器支持的语言：less、sass</p><p><strong>解决css文件细分问题</strong></p><p>利用一些loader或plugin来打包、合并、压缩css文件</p><h2 id="css-loader" tabindex="-1"><a class="header-anchor" href="#css-loader" aria-hidden="true">#</a> css-loader</h2><p>webpack本身只能读取css文件内容，将其当作js代码进行分析就会导致错误，所以必须有一个loader将css代码转换成js代码</p><p>css-loader处理原理：</p><ul><li>将css代码作为字符串导出,及导出更多其他信息（不细究）</li><li>将css中的其他依赖作为require导入，方便webpack分析依赖</li></ul><p>仅处理类名，不处理其他选择器如元素选择器，id选择器</p><h2 id="style-loader" tabindex="-1"><a class="header-anchor" href="#style-loader" aria-hidden="true">#</a> style-loader</h2><p>css-loader仅提供了将css转换未字符串导出的能力，剩余的事情要交给其他loader或pulgin处理</p><p>style-loader可以将cssloader转换后的代码进一步处理，将导出的字符串加入到页面的style元素中</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">//rules的匹配顺序和loader的执行顺序都是从右往左（从下往上）</span>
      <span class="token punctuation">{</span>     
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">//匹配的模块正则</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
              <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">{</span>
                      <span class="token literal-property property">localIdentName</span><span class="token operator">:</span><span class="token string">&#39;[locale]_[hash:5]&#39;</span><span class="token punctuation">,</span><span class="token comment">//修改转换后名字，默认hash</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png)|(gif)|(jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>   
              <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;file-loader&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;[name].[hash:5].[ext]&quot;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
      
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="webpack中使用less" tabindex="-1"><a class="header-anchor" href="#webpack中使用less" aria-hidden="true">#</a> webpack中使用less</h2><p>项目入口文件引入less文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&#39;./index.less&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> less-loader <span class="token function">less</span> <span class="token comment"># less-loader只是提供一个函数，真正要把less转换成css还需要less，所以需要安装less的核心库</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token comment">//rules的匹配顺序和loader的执行顺序都是从右往左（从下往上）</span>
      <span class="token punctuation">{</span>     
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">//匹配的模块正则</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
              <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">{</span>
                      <span class="token literal-property property">localIdentName</span><span class="token operator">:</span><span class="token string">&#39;[local]_[hash:5]&#39;</span><span class="token punctuation">,</span><span class="token comment">//修改转换后名字，默认hash</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>     
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">//匹配的模块正则</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
              <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">{</span>
                      <span class="token literal-property property">localIdentName</span><span class="token operator">:</span><span class="token string">&#39;[local]_[hash:5]&#39;</span><span class="token punctuation">,</span><span class="token comment">//修改转换后名字，默认hash</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png)|(gif)|(jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>   
              <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;file-loader&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;[name].[hash:5].[ext]&quot;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
      
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现umijs中自动css模块化" tabindex="-1"><a class="header-anchor" href="#实现umijs中自动css模块化" aria-hidden="true">#</a> 实现umiJs中自动css模块化</h2><p>实现以下效果</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&#39;./index.less&#39;</span>  <span class="token comment">//不使用模块化</span>
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">&#39;./index.less&#39;</span>  <span class="token comment">//使用模块化</span>

<span class="token comment">/*
	实现原理：
	以上两种写法，转换AST后可以看到specifiers这个字段，没有变量接收时为空
	根据这个不同的字段去给启用css modules的文件打标签
	用webpack的rules规则匹配字段oneOf进行匹配
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#安装babel相关插件</span>
<span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> babel-loader @babel/core @babel/preset-env @umijs/babel-plugin-auto-css-modules
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>新建babel配置文件：<strong>.babelrc</strong></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@umijs/babel-plugin-auto-css-modules&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;flag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;modules&quot;</span>   <span class="token comment">//默认添加的标识就是modules，可以不写</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改webpack.config.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// open: true,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.html&quot;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|jsx|ts|tsx)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>       <span class="token comment">//++++</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules|bower_components)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//++++</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">//++++</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//匹配的模块正则</span>
        <span class="token literal-property property">oneOf</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">resourceQuery</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>     <span class="token comment">//匹配添加的标识字符串</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">localIdentName</span><span class="token operator">:</span> <span class="token string">&quot;[local]_[hash:5]&quot;</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动项目查看两种导入方式的类名是否不同</p><h2 id="postcss" tabindex="-1"><a class="header-anchor" href="#postcss" aria-hidden="true">#</a> PostCss</h2><p>postcss类似一个编译器，把我们编写的源样式代码编译成最终的css代码。</p><p>但和less、sass不同的是，它只做一些代码分析的工作，将分析的结果交给插件，具体的代码转换操作是插件去完成的。</p><p>有点像webpack，只做代码分析工作，其他由插件和加载器完成。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> postcss postcss-cli

postcss 源码文件 <span class="token parameter variable">-o</span> 输出文件 <span class="token comment"># postcss-cli提供一个命令，它调用postcss中的api来完成编译</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>样式文件拓展名有pcss 、postcss、sss、css也可以</p><p><strong>配置文件</strong> ：postcss.config.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">map</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//关闭sourcemap</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="插件市场" tabindex="-1"><a class="header-anchor" href="#插件市场" aria-hidden="true">#</a> <a href="https://www.postcss.parts/" target="_blank" rel="noopener noreferrer">插件市场<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><h4 id="postcss-preset-env" tabindex="-1"><a class="header-anchor" href="#postcss-preset-env" aria-hidden="true">#</a> <strong>postcss-preset-env</strong></h4><p>（需要npm安装）: postcss预设环境，它整合了很多常用的插件，并帮你完成基本配置，只需要安装它这一个插件，就相当于安装了很多插件。</p><h5 id="自动厂商前缀" tabindex="-1"><a class="header-anchor" href="#自动厂商前缀" aria-hidden="true">#</a> 自动厂商前缀</h5><p>为了兼容一些旧样式，可能需要给样式加上内核前缀，但这个操作很繁琐，要完成这件事可以使用<strong>autoprefixer</strong>库，而<strong>postcss-preset-env</strong>内部已包含该库，自动有该功能。还可以<strong>调整兼容的浏览器范围</strong>,</p><p>方法1：修改<strong>postcss-preset-env</strong>的brosers配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">map</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//关闭sourcemap</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;postcss-preset-env&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">browsers</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token string">&#39;last 2 version&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//浏览器兼容最近期的两个版本</span>
                <span class="token string">&#39;&gt; 1%&#39;</span><span class="token punctuation">,</span> <span class="token comment">//  匹配大于1%的人使用的浏览器</span>
                <span class="token string">&#39;not ie &lt;= 8&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 排除版本号小于等于8的ie浏览器</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方法2：添加 .browserslistrc 文件(推荐，比如js兼容也可以读取这个配置)</p><p>创建文件.browserslistrc并配置内容</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>last 3 version
&gt; 1%
not ie &lt;= 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方法3：package.json配置中加入broserslist</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;browserslist&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">&quot;last 2 version&quot;</span><span class="token punctuation">,</span>  
        <span class="token string">&quot;&gt; 1%&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://browsersl.ist/" target="_blank" rel="noopener noreferrer">在线匹配兼容性浏览器<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，查询时，多行之间用逗号隔开</p><h5 id="未来的css" tabindex="-1"><a class="header-anchor" href="#未来的css" aria-hidden="true">#</a> 未来的Css</h5><p>css的某些前沿语法正在制定过程中，没有形成真正的标准，如果希望使用这部分语法，为了浏览器兼容性，需要进行编译</p><p>过去完成该语法编译的是cssnext库，不过postcss-preset-env现自动包含了该功能，通过postcss-preset-env的stage配置，告知它需要对哪个阶段的css语法进行兼容处理，默认值为2</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">map</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//关闭sourcemap</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;postcss-preset-env&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">stage</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token comment">//代表哪怕是草案阶段的语法，也需要转换</span>
            <span class="token literal-property property">preserve</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">,</span> <span class="token comment">//如果不希望在结果中看到新语法，可以配置为false,只保留兼容代码</span>
            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Stage0：只是一个早期草案，极其不稳定</p><p>Stage1: 仍然极其不稳定，但是提议已被w3c公认</p><p>Stage2：虽然还是不稳定，但已经可以使用了</p><p>Stage3：比较稳定，可能将来会发生一些小的变化，它即将成为最终的标准</p><p>Stage4：所有主流浏览器都应该支持的w3c标准</p><h2 id="webpack中使用postcss" tabindex="-1"><a class="header-anchor" href="#webpack中使用postcss" aria-hidden="true">#</a> webpack中使用PostCss</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> i <span class="token parameter variable">-D</span> postcss postcss-loader postcss-preset-env
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>webpack配置：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//在css-loader前使用</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>postcss的配置单独使用postcss.config.js来编写</p><h2 id="抽离css文件" tabindex="-1"><a class="header-anchor" href="#抽离css文件" aria-hidden="true">#</a> 抽离css文件</h2><p>style-loader是将样式插入到style元素中，而实际开发中，我们希望把样式最终形成一个css文件</p><p>就需要用到一个库：<strong>mini-css-extract-plugin</strong></p><p>它提供了1个plugin和1个loader</p><ul><li>plugin：负责生成css文件</li><li>loader：负责记录要生成的css文件的内容，同时导出开启css-module后的样式对象</li></ul><p>替换掉原来的style-loader，最终css会抽离成一个独立的文件，并在html中引入</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name]-[hash:6].js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">publicPath</span><span class="token operator">:</span><span class="token string">&#39;/&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// open: true,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// ++</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|jsx|ts|tsx)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules|bower_components)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">//匹配的模块正则</span>
        <span class="token literal-property property">oneOf</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">resourceQuery</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>  <span class="token comment">// +++</span>
              <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">localIdentName</span><span class="token operator">:</span> <span class="token string">&quot;[local]_[hash:5]&quot;</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>    <span class="token comment">// +++</span>
              <span class="token punctuation">{</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="babel" tabindex="-1"><a class="header-anchor" href="#babel" aria-hidden="true">#</a> babel</h2><p>babel象征统一的国度、统一的语言。</p><p>babel就是个编译器，做js语言兼容的</p><p>由于语言的转换工作灵活多样，babel的做法和postcss、webpack差不多，它本身仅提供一些分析功能，真正的转换需要依托于插件完成</p><p>babel可以和构建工具联合使用，也可以独立使用如果要独立的使用babel，需要安装下面两个库：</p><ul><li><p>@babel/core：babel核心库，提供了编译所需的所有api</p></li><li><p>@babel/cli：提供一个命令行工具，调用核心库的api完成编译</p></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i-D @babel/core @babel/cli

<span class="token comment">#按文件编译</span>
babel 要编译的文件 <span class="token parameter variable">-o</span> 输出文件

<span class="token comment">#按目录编译</span>
babel 要编译的目录 <span class="token parameter variable">-d</span> 输出目录
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如何告诉babel要使用哪些插件或预设呢需要通过一个配置文件.babelrc</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;preset&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="babel预设" tabindex="-1"><a class="header-anchor" href="#babel预设" aria-hidden="true">#</a> babel预设</h3><p>babel有多种预设，最常见的预设是@babel/preset-env</p><p>@babel/preset-env可以让你使用最新的Js语法，而无需针对每种语法转换设置具体的插件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;preset&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">//多个预设的时候，顺序也是从后向前</span>
     <span class="token comment">//如果要给预设传参，则使用下面的写法</span>
     <span class="token string-property property">&quot;preset&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
             <span class="token string-property property">&quot;usebuiltIns&quot;</span><span class="token operator">:</span><span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//默认为false,遇到新的api不做任何处理。为usage则按需构建新的api、比如老的浏览器可能不支持Promise</span>
             <span class="token string-property property">&quot;corejs&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment">//兼容引用的corejs版本</span>
         <span class="token punctuation">}</span><span class="token punctuation">]</span>
     <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@babel/preset-env也会读取.browserslistrc文件来决定兼容的浏览器范围</p><p>还需要安装<strong>core-js</strong> 和<strong>regenerator-runtime</strong>两个库才能对一些较新的api进行转换,promise,async/await 等</p><h3 id="babel插件" tabindex="-1"><a class="header-anchor" href="#babel插件" aria-hidden="true">#</a> babel插件</h3><p>除了预设可以转换代码之外，插件也可以转换代码，它们的顺序是</p><ul><li>插件在Presets 前运行。</li><li>插件顺序从前往后排列。</li><li>Preset顺序是颠倒的（从后往前）</li></ul><p><strong>即先运行插件再运行预设</strong></p><p>通常情况下，@babel/preset-env 只转换那些已经形成正式标准的语法，对于某些处于早期阶段、还没有确定的语法不做转换。如果要转换这些语法，就要单独使用插件</p><p><strong>babel-plugin-transform-remove-console</strong></p><p>该插件会移除源码中的控制台输出语句</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;plugin&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;babel-plugin-transform-remove-console&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
     <span class="token comment">//如果要传参，跟preset的写法一样</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="webpack中使用babel" tabindex="-1"><a class="header-anchor" href="#webpack中使用babel" aria-hidden="true">#</a> webpack中使用babel</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> babel-loader @babel/core @babel/preset-env core-js regenerator-runtime
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>新建 <strong>.babelrc 文件</strong></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token property">&quot;usebuiltIns&quot;</span><span class="token operator">:</span><span class="token string">&quot;usage&quot;</span><span class="token punctuation">,</span> 
      <span class="token property">&quot;corejs&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>  
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还有 <strong>.broserlistrc</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>last 3 version
&gt; 1%
not ie &lt;= 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="性能优化" tabindex="-1"><a class="header-anchor" href="#性能优化" aria-hidden="true">#</a> 性能优化</h2><ul><li><p>构建性能：指在<strong>开发阶段的构建性能</strong>而不是生产环境的构建性能。优化的目标，是<strong>降低从打包开始，到代码效果呈现所经过的时间</strong>。构建性能会影响开发效率。构建性能越高，开发过程中时间的浪费越少</p></li><li><p>传输性能：指打包后的JS代码传输到浏览器经过的时间在优化传输性能时要考虑到：</p><ol><li>总传输量：所有需要传输的JS文件的内容加起来，就是总传输量，重复代码越少，总传输量越少</li><li>文件数量：当访问页面时，需要传输的Js文件数量，文件数量越多，http请求越多，响应速度越慢</li><li>浏览器缓存：JS文件会被浏览器缓存，被缓存的文件不会再进行传输</li></ol></li><li><p>运行性能：指JS代码在浏览器端的运行速度。它主要取决于我们如何书写高性能的代码。<strong>永远不要过早的关注于性能</strong>，因为你在开发的时候，无法完全预知最终的运行性能，过早的关注性能会极大的降低开发效率</p></li></ul><h3 id="减少模块解析" tabindex="-1"><a class="header-anchor" href="#减少模块解析" aria-hidden="true">#</a> 减少模块解析</h3><p>模块解析包括：抽象语法树分析、依赖分析、模块语法替换。</p><p>如果某个模块不做解析，该模块经过loader处理后的代码就是最终代码。</p><p>如果没有loader对该模块进行处理，该模块的源码就是最终打包结果的代码。</p><p>如果不对某个模块进行解析，可以缩短构建时间</p><p><strong>哪些模块不需要解析？</strong></p><p>模块中无其他依赖、或一些已经打包好的第三方库，比如jquery</p><p><strong>如何让某个模块不要解析？</strong></p><p>配置module.noParse,它是一个正则，被正则匹配到的模块不会解析</p><h3 id="优化loader性能" tabindex="-1"><a class="header-anchor" href="#优化loader性能" aria-hidden="true">#</a> 优化loader性能</h3><p><strong>进一步限制loader的应用范围</strong></p><p>思路是：对于某些库，不使用loader</p><p>例如：babel-loader可以转换ES6或更高版本的语法，可是有些库本身就是用ES5语法书写的，不需要转换，使用babel-loader反而会浪费构建时间</p><p>lodash是在ES5之前出现的库，使用的是ES3语法</p><p>通过 <strong>module.rule.exclude</strong> 或 <strong>module.rule.include</strong>，<strong>排除或仅包含</strong>需要应用loader的场景</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">loadash</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token string">&#39;babel-loader&#39;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>缓存loader的结果</strong></p><p>**webpack5中已默认开启打包缓存，无需安装cache-loader。**可通过cache配置更改缓存方式，默认memory，还有filesystem(还需配置cacheDirectory)</p><p><code>cache</code> 会在开发模式被设置成 <code>type: &#39;memory&#39;</code> 而且在生产模式中被禁用。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cache</span><span class="token operator">:</span><span class="token punctuation">{</span>
    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>我们可以基于一种假设：如果某个文件内容不变，经过相同的loader解析后，解析后的结果也不变。</p><p>所以可以将loader的解析结果保存下来，让后续的解析直接使用保存的结果<strong>cache-loader</strong> 可以实现这样的功能</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;cache-loader&#39;</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">,</span><span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有趣的是，cache-loader放在最前面，却能够决定后续的loader是否运行。</p><p>实际上，loader的运行过程中，还包含一个过程，即pitching</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&#39;new source&#39;</span>
<span class="token punctuation">}</span>

loader<span class="token punctuation">.</span><span class="token function-variable function">pitch</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">remainingRequest<span class="token punctuation">,</span> prevReq<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//第三个参数可以给后续loader传参</span>
    <span class="token comment">//可返回可不返回</span>
    <span class="token comment">//如果返回，返回源代码</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span>loader<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>loader pitch的执行顺序和配置loader的顺序一样，<strong>从左到右</strong>，再从右到左执行它的normal loader</p><p>假设配置了**[a,b,c]**三个loader，</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 正常的执行顺序</span>
<span class="token operator">|</span>- a-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
  <span class="token operator">|</span>- b-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
    <span class="token operator">|</span>- c-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
      <span class="token operator">|</span>- requested module is picked up as a dependency
    <span class="token operator">|</span>- c-loader normal execution
  <span class="token operator">|</span>- b-loader normal execution
<span class="token operator">|</span>- a-loader normal execution

<span class="token comment"># 如果loader 中 pitch 方法返回了一个结果，则会立即停止递归，并且执行上一个loader的 normal 方法</span>
<span class="token operator">|</span>- a-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span>
  <span class="token operator">|</span>- b-loader <span class="token variable"><span class="token variable">`</span>pitch<span class="token variable">`</span></span> returns a module
<span class="token operator">|</span>- a-loader normal execution
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>loader多线程打包</strong></p><p>thread-loader会开启一个线程池，它会把后续的loader放到线程池的线程中运行，以提高构建效率</p><p>由于后续的loader会放到新的线程中，所以后续的loader不能：</p><ul><li>使用webpack api生成文件。因为webpack是基于node单线程运行的，跑到别的线程就用不了了</li><li>无法使用自定义的plugin api，如 MiniCssExtractPlugin.loader</li><li>无法访问webpack options</li></ul><p>在实际的开发中，可以进行测试，来决定thread-loader放到什么位置</p><p>特别注意，开启和管理线程需要消耗时间，在小型项目中使用thread-loader反而会增加构建时间</p><h3 id="热替换hmr" tabindex="-1"><a class="header-anchor" href="#热替换hmr" aria-hidden="true">#</a> 热替换HMR</h3><p>热替换(Hot Module Replacement)并不能降低构建时间（可能还会稍微增加），但可以降低代码改动到效果呈现的时间</p><p>当使用webpack-dev-server时，代码改动到效果呈现的过程：</p><p>代码变动》重新打包》浏览器刷新重新请求所有资源》浏览器执行代码</p><p>当使用了热替换后的过程：</p><p>代码变动》重新打包》浏览器仅请求改动的资源》浏览器执行代码</p><p><strong>使用</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">devServer</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">hot</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//开启热替换</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>入口文件,添加以下内容</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//是否开启了热更新</span>
   module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//接收热更新</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码会参与最终运行！</p><p>当开启了热更新后，webpack-dev-server会向打包结果中注入module.hot 属性</p><p>默认情况下，webpack-dev-server不管是否开启了热更新，当重新打包后，都会调用location.reload刷新页面</p><p>但如果运行了 module.hot.accept(），将改变这一行为</p><p>module.hot.accept（）的作用是让webpack-dev-server通过socket管道，把服务器更新的内容发送到浏览器</p><p>然后，将结果交给插件HotModuleReplacementPlugin 它会覆盖原始代码，然后让代码重新执行</p><p><strong>热替换发生在代码运行期</strong></p><p><strong>样式热更新</strong></p><p>对于样式也是可以使用热替换的，但需要使用<strong>style-loader</strong></p><p>因为热替换发生时，HotMqduleReplacementPlugin 只会简单的重新运行模块代码(可以理解为重新调用入口文件，所以这时候改html模板文件的内容也不会更新，因为它也是最后构建出来的文件，而不是入口文件的所需要执行的依赖)</p><p>因此 style-loader 的代码一运行，就会重新设置 style 元素中的样式</p><p>而 mini-css-extract-plugin ( 它的<strong>工作方式是</strong>在构建时生成独立的 CSS 文件，并将其链接到 HTML 文件中，而不是将 CSS 作为 JavaScript 模块加载)，由于它生成文件是在<strong>构建期间</strong>，运行期间并会也无法改动文件，因此它对于热替换是无效的</p><p>这两种机制的冲突在于，<strong>HMR 需要 CSS 能够被模块化加载</strong>，以便在运行时进行替换，而 MiniCssExtractPlugin 将 CSS 提取到了单独的文件中，不再将其作为模块加载。</p><h3 id="手动分包" tabindex="-1"><a class="header-anchor" href="#手动分包" aria-hidden="true">#</a> 手动分包</h3><p><strong>分包</strong>：将一个整体的代码，分布到不同的打包文件中</p><p>为什么要分包：</p><ul><li>减少（抽离）公共代码，降低总体积</li><li>充分利用浏览器缓存</li></ul><p>什么时候分包：</p><ul><li>多个chunk引入了公共模块</li><li>公共模块体积较大或较少的变动</li></ul><p><strong>手动分包总体思路：</strong></p><ol><li><p>先单独打包公共模块。如lodash、jquery等</p><ul><li><p>新建一个webpack配置文件，对第三方公共模块进行单独打包</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//webpack.dll.config.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">jquery</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;jquery&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">lodash</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">&quot;dll/[name].js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">library</span><span class="token operator">:</span><span class="token string">&quot;[name]&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;manifest&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;[name].manifest.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//当前目录下的manifest文件夹，每个chunk都会生成对应的资源清单文件</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;[name]&quot;</span><span class="token comment">//资源清单中，暴露的变量名</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改script执行命令并打包</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;script&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        ...<span class="token punctuation">,</span>
        <span class="token property">&quot;dll&quot;</span><span class="token operator">:</span><span class="token string">&quot;webpack --config webpack.dll.config·js&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>根据入口模块进行正常打包</p><ul><li>在页面(<strong>打包模板页面</strong>)中手动引入公共模块</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>./dll/jquery.js<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--或者可以引入cdn--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>./dll/lodash.js<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>修改CleanWebpackPlugin配置</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">cleanOnceBeforeBuildPatterns</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;**/*&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;!dll&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;!dll/*&#39;</span><span class="token punctuation">]</span>  <span class="token comment">//第一个参数是清楚所有目录下的所有文件,后面的参数是排除</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>用Dl1ReferencePlugin控制打包结果</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">manifest</span><span class="token operator">:</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./manifest/jquery.manifest.json&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">manifest</span><span class="token operator">:</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./manifest/lodash.manifest.json&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p><strong>总结：</strong></p><ol><li>开启output.library暴露公共模块</li><li>用DllPlugin创建资源清单</li><li>DllReferencePlugin使用资源清单</li></ol><p>前两步是对公共模块的打包操作，第三步是原项目的打包操作</p><p><strong>注意事项：</strong></p><ol><li>资源清单（DllPlugin生成的json文件）不参与运行，可以不放到打包目录中</li><li>记得手动引I入公共JS，以及避免被删除</li><li>不要对小型的公共JS库使用</li></ol><h3 id="自动分包" tabindex="-1"><a class="header-anchor" href="#自动分包" aria-hidden="true">#</a> 自动分包</h3><p>不同与手动分包，自动分包是从实际的角度出发，从一个更加宏观的角度来控制分包，而一般<strong>不对具体哪个包</strong>要分出去进行控制</p><p>控制自动分包，关键是要配置一个合理的<strong>分包策略</strong>，有了分包策略之后，不需要额外安装任何插件，webpack会自动的按照策略进行分包</p><p>实际上，<strong>Webpack在内部</strong>是使用<strong>SplitChunksPlugin</strong>进行分包的</p><ul><li><p>分包时，webpack开启了一个新的chunk，对分离的模块进行打包</p></li><li><p>打包结果中，公共的部分被提取出来形成了一个单独的文件，它是新chunk的产物</p></li></ul><p><strong>分包的基本配置</strong></p><p>webpack提供了<strong>optimization</strong>配置项，用于配置一些优化信息，其中<strong>splitChunks</strong>是分包策略的配置</p><p>事实上，分包策略有其默认的配置，我们只需要轻微的改动，即可应对大部分分包场景</p><ol><li><p><strong>chunks</strong></p><p>该配置项用于配置需要应用分包策略的chunk</p><p>我们知道，分包是从已有的chunk中分离出新的chunk，那么哪些chunk需要分离呢 chunks有三个取值，分别是：</p><ul><li>all：对于所有的chunk都要应用分包策略</li><li>async：【默认】仅针对异步chunk应用分包策略</li><li>initial：仅针对普通chunk应用分包策略</li></ul><p>所以，你只需要配置chunks为all即可</p></li><li><p>maxSize(慎用)</p><p>该配置可以控制包的最大字节数</p><p>如果某个包（包括分出来的包）超过了该值，则webpack会尽可能的将其分离成多个包，但是不要忽略的是，分包的基础单位是模块。如果一个完整的模块超过了该体积，它是无法做到再切割的，因此，尽管使用了这个配置，完全有可能某个包还是会超过这个体积</p><p>另外，该配置看上去很美妙，实际意义其实不大</p><p>因为分包的目的是提取大量的公共代码，从而减少总体积和充分利用浏览器缓存.</p><p>虽然该配置可以把一些包进行再切分，但是实际的总体积和传输量并没有发生变化</p><p>如果要进一步减少公共模块的体积，只能是<strong>压缩</strong>和 <strong>tree shaking</strong></p></li><li><p>automaticNameDelimiter(一般不改)：新chunk名称的分隔符，默认值~</p></li><li><p>minChunks(一般不改): 一个模块被多少个chunk使用时，才会进行分包，<strong>默认值1</strong></p></li><li><p>minSize(一般不改)：当分包达到多少字节后才允许被真正的拆分，默认值30000</p></li><li><p><strong>cacheGroups</strong>：缓存组。之前配置的分包策略是全局的，而实际上，分包策略是基于缓存组的。每个缓存组提供一套独有的策略，webpack按照缓存组的优先级依次处理每个缓存组，被缓存组处理过的分包不需要再次分包。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">splitChunks</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token comment">//属性名是缓存组名称，会影响到分包的chunk名</span>
                <span class="token comment">//属性值是缓存组的配置，缓存组继承所有的全局配置，也有自己特殊的配置</span>
                <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    test：<span class="token operator">/</span><span class="token punctuation">[</span>\\<span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//当匹配到相应模块时，将这些模块进行单独打包</span>
                    priority：<span class="token operator">-</span><span class="token number">10</span><span class="token comment">//缓存组优先级，优先级越高，该策略越先进行处理，默认值为0</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">minchunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//覆盖全局配置，将最小chunk引用数改为2</span>
                    priority：<span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token comment">// 优先级</span>
                    reuseExistingChunk：<span class="token boolean">true</span><span class="token comment">//重用已经被分离出去的chunk</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的是webpack默认提供的两个缓存组，一般情况下也不需要改动，我们可以利用它抽取公共的css模块</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">splitChunks</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">styles</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                    <span class="token literal-property property">minChunks</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">minSize</span><span class="token operator">:</span><span class="token number">20000</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">&#39;[name].[hash:5].css&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span><span class="token string">&quot;common.[hash:5].css&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//配置chunk分割出去的文件名</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="单模块体积压缩" tabindex="-1"><a class="header-anchor" href="#单模块体积压缩" aria-hidden="true">#</a> 单模块体积压缩</h3><p>webpack安装后会内置Terser这个代码压缩工具，启用生产环境后即可用其进行代码压缩</p><p>也是通过<strong>optimization</strong>进行配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;terser-webpack-plugin&#39;</span><span class="token punctuation">)</span>  <span class="token comment">//+++</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;optimize-css-assets-webpack-plugin&quot;</span><span class="token punctuation">)</span> <span class="token comment">//+++</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token comment">//minimize:true, //不用改，默认情况下，生产环境会开启，如果为true，则开发环境也会开启</span>
        <span class="token comment">//usedExports: true,  //可在开发环境启用tree shaking</span>
        <span class="token literal-property property">minimizer</span><span class="token operator">:</span><span class="token punctuation">[</span>  <span class="token comment">//+++</span>
            <span class="token comment">//压缩时使用的插件</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">//+++</span>
            <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//+++</span>
        <span class="token punctuation">]</span> <span class="token comment">//+++</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tree-shaking" tabindex="-1"><a class="header-anchor" href="#tree-shaking" aria-hidden="true">#</a> tree shaking</h3><p>压缩可以移除模块内部的无效代码</p><p>tree-shaking可以移除模块之间的无效代码(某些模块导出的代码不一定会用到,tree-shaking用于移除不会使用的导出)</p><p>只要是生产环境，tree-shaking自动开启</p><p>webpack5需要在package.json中配置sideEffects,本来配置个false就行（即告诉webpack全都没有副作用，可以放心删除），但是它会导致MiniCssExtractPlugin抽离css文件失败（把css代码删了）,所以得用数组设置，告诉webpack css文件都有副作用，要给我保留</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当解析一个模块时，webpack会根据ES6的模块导入语句来判断，该模块依赖了另一个模块的哪个导出</p><p>webpack之所以选择ES6的模块导入语句，是因为ES6模块有以下特点：</p><ol><li>导入导出语句只能是顶层语句</li><li>import的模块名只能是字符串常量</li><li>import绑定的变量是不可变的</li></ol><p>而commonjs的导入可以是动态的，webpack又不会执行你的代码，因此不能稳定的分析出依赖,为了保证你代码的正常运行，不确定的东西它会给你保留。</p><p>某些第三方库可能使用的是commonjs的方式导出，比如 lodash，又或者没有提供普通的ES6方式导出,对于这些库，tree shaking 是无法发挥作用的。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//这种导出能正常分析出依赖</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">sub</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//这种导出无法准确分析</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">sub</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因此要寻找这些库的 es6 版本，好在很多流行但没有使用的 ES6 的第三方库， 都发布了它的 Es6 版本，比如 lodash-es</p><p>**副作用：**一个函数会、或者可能会对函数外部变量产生影响的行为。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//这个函数修改了全局变量location，甚至还让浏览器发生了跳转，这就是一个有副作用的函数</span>
<span class="token keyword">function</span> <span class="token function">go</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> url
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>即使写的代码是无副作用的，但是经过babel编译后，也可能会产生副作用代码，</p><h3 id="懒加载" tabindex="-1"><a class="header-anchor" href="#懒加载" aria-hidden="true">#</a> 懒加载</h3><p>懒加载就是等用户需要用到某部分模块的代码才去加载对应的js，由于写法复杂且会改变日常写代码习惯，不做例子展示，React和Vue都有自己的方式实现懒加载组件和路由</p><h2 id="eslint" tabindex="-1"><a class="header-anchor" href="#eslint" aria-hidden="true">#</a> ESLint</h2><p>代码风格检查。</p><p>需要和编辑器配合，vscode安装eslint插件</p><p>全局安装或项目里安装</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i <span class="token parameter variable">-g</span> eslint
npx eslint <span class="token parameter variable">--init</span> <span class="token comment"># 初始化配置文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>新建配置文件 <strong>.eslintrc</strong> ,js格式（.eslintrc.js）或json格式都可以，也可以识别package.json的eslintConfig字段。如果没有配置文件也不会去检查</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">//代码是否在浏览器环境运行</span>
    <span class="token literal-property property">es2021</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token comment">//是否启用最新的es Api</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">&#39;airbnb&#39;</span><span class="token punctuation">,</span>   <span class="token comment">// 配置继承自哪里。值可以是字符串或数组</span>
  <span class="token literal-property property">overrides</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;.eslintrc.{js,cjs}&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&#39;script&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token comment">//该配置指定eslint对哪些语法的支持</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token string">&#39;latest&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//最新</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&#39;module&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//模块化脚本、script：传统脚本-没有type=module</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">//规则集</span>
      
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//eslint的工作原理是先将代码解析，然后按照规则进行分析。eslint默认使用Espree作为解析器，可以在配置文件中指定不同的解析器,比如ts和react等特殊的语法就要相应的解析器</span>
  <span class="token comment">//parser:{},</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>.eslintignore</strong> 排除掉不需要验证的文件</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>node_modules
**/dist/**/*.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>rules</strong>规则集</p><p>每个规则都可以有下面的几个取值,true 和false有些规则不一定支持，尽量不使用</p><ul><li>off、0、false：关闭该规则的检查</li><li>warn、1、true：警告，不会导致程序退出</li><li>error、2：错误，当被触发时，程序会退出</li></ul><p>除了在配置文件中使用规则外，还可以在注释中使用</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*  eslint eqeqeq:&quot;off&quot;,curly:&quot;error&quot; */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>https://eslint.nodejs.cn/docs/latest/rules/</p><h2 id="bundle-analyzer" tabindex="-1"><a class="header-anchor" href="#bundle-analyzer" aria-hidden="true">#</a> bundle analyzer</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> WebpackBundleAnalyzer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">WebpackBundleanalyzer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="gzip" tabindex="-1"><a class="header-anchor" href="#gzip" aria-hidden="true">#</a> gzip</h2><p>gzip是一种压缩文件的算法</p><p><img src="/xjblog/assets/image-20240304160736715-051d5205.png" alt="image-20240304160736715"></p><p>优点：传输效率可能得到大幅提升</p><p>缺点：服务器的压缩需要时间，客户端的解压需要时间</p><p><strong>使用webpack进行预压缩</strong></p><p>使用compression-webpack-plugin插件对打包结果进行预压缩，可以移除服务器的压缩时间，即上图的第二步变成读取压缩后的文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> CmpressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;compression-webpack-plugin&quot;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CmpressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>   <span class="token comment">//可以只针对某些文件预压缩</span>
            <span class="token literal-property property">minRatio</span><span class="token operator">:</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token comment">//压缩比，默认0.8，即压缩后大小在原来80%才压缩</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="npm-run-all" tabindex="-1"><a class="header-anchor" href="#npm-run-all" aria-hidden="true">#</a> npm-run-all</h2><p>比如构建全栈项目，一个client文件夹，一个server文件夹，需要执行多次打包，想通过一条命令来完成全部打包，按照标题插件</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    ...<span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span><span class="token string">&quot;npm-run-all -s build:server build:client&quot;</span><span class="token punctuation">,</span> <span class="token comment">// -s表示依次执行后面的命令,-p是并行运行</span>
    <span class="token property">&quot;build:server&quot;</span><span class="token operator">:</span><span class="token string">&quot;cross-env NODE_ENV=production webpack&quot;</span><span class="token punctuation">,</span> <span class="token comment">//打包服务端代码</span>
    <span class="token property">&quot;build:client&quot;</span><span class="token operator">:</span><span class="token string">&quot;cd client &amp;&amp; npm run build&quot;</span>  <span class="token comment">// 进入客户端文件夹并打包</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scope-hoisting" tabindex="-1"><a class="header-anchor" href="#scope-hoisting" aria-hidden="true">#</a> scope hoisting</h2><p>作用域提升</p><p>scope hoisting 是webpack的内置优化，它是针对模块的优化 在生产环境打包时会自动开启。</p><p>在<strong>未开启scope hoisting时</strong>，webpack 会将<strong>每个模块</strong>的代码<strong>放置在一个独立的函数环境中</strong>，这样是为了保证模块的<strong>作用域互不干扰</strong>。</p><p>而 scope hoisting 的作用恰恰相反，是<strong>把多个模块的代码合并到一个函数环境中执行</strong>。在这一过程中,</p><p>webpack 会按照顺序正确的合并模块代码，同时对涉及的标识符做适当处理以避免重名。</p><p>这样做的好处是减少了函数调用，对运行效率有一定提升，同时也降低了打包体积</p><p>但 scope hoisting 的启用是有<strong>前提的</strong>，如果遇到某些模块多次被其他模块引用，或者<strong>使用了动态导入的模块</strong>，或者是<strong>非 ESM 的模块</strong>，都不会有 scope hoisting。</p><h2 id="experiments实验特性" tabindex="-1"><a class="header-anchor" href="#experiments实验特性" aria-hidden="true">#</a> experiments实验特性</h2><p><code>experiments</code> 配置是在 webpack 5 中推出，目的是为了给用户赋能去开启并试用一些实验的特性。</p><p><strong>警告</strong></p><p>由于实验特性具有相对 宽松的语义版本，可能会有重大的变更，所以主确定你将 webpack 的版本固定为小版本号，例如与其使用 <code>webpack: ~5.4.3</code> 不如使用 <code>webpack: ^5.4.3</code> 或者当使用 <code>experiments</code> 配置时使用版本锁定能力。</p><h3 id="toplevelawait" tabindex="-1"><a class="header-anchor" href="#toplevelawait" aria-hidden="true">#</a> topLevelAwait</h3><p>允许在模块的顶部代码中直接使用await</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;xxxx&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jsonbody <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> jsonbody<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要在webpack.config.js中配置开启</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">experiments</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">topLevelAwait</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模块联邦" tabindex="-1"><a class="header-anchor" href="#模块联邦" aria-hidden="true">#</a> 模块联邦</h2><p>webpack5的更新的内容，是解决微前端中如何共享代码的问题</p><h2 id="为什么vite比webpack快" tabindex="-1"><a class="header-anchor" href="#为什么vite比webpack快" aria-hidden="true">#</a> 为什么vite比webpack快</h2><p><strong>开发模式的差异</strong>：在开发环境中，Webpack是先打包再启动开发服务器，而Vite 则是直接启动，然后再按需编译依赖文件</p><p>这意味着，当使用Webpack时，所有的模块都需要在开发前进行打包，这会增加启动时间和构建时间。</p><p>而Vite则采用了不同的策略，它会在请求模块时再进行实时编译，这种按需动态编译的模式极大地缩短了编译时间</p><p><strong>语言优势</strong>：Webpack 是基于Node.js 构建的，而 Vite 则是基于 esbuild 进行预构建依赖。esbuild 是采用Go 语言编写的，Go语言是纳秒 级别的，而 Node.js是毫秒级别的。因此，Vite 在打包速度上相比Webpack有10-100倍的提升。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/xjblog/more/xlsx.html" class="" aria-label="xlsx"><!--[--><!--]--> xlsx <!--[--><!--]--></a></span><span class="next"><a href="/xjblog/more/websocket.html" class="" aria-label="websocket"><!--[--><!--]--> websocket <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/xjblog/assets/app-6fcf50f1.js" defer></script>
  </body>
</html>
