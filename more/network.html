<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>XJ-Blog</title><meta name="description" content="">
    <link rel="preload" href="/xjblog/assets/style-82cbce61.css" as="style"><link rel="stylesheet" href="/xjblog/assets/style-82cbce61.css">
    <link rel="modulepreload" href="/xjblog/assets/app-c984cf19.js"><link rel="modulepreload" href="/xjblog/assets/network.html-3692f09e.js"><link rel="modulepreload" href="/xjblog/assets/network.html-5aa31fdc.js"><link rel="prefetch" href="/xjblog/assets/index.html-2320b9e9.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-62e263ac.js" as="script"><link rel="prefetch" href="/xjblog/assets/css.html-612bf7f2.js" as="script"><link rel="prefetch" href="/xjblog/assets/flex.html-1426b188.js" as="script"><link rel="prefetch" href="/xjblog/assets/grid.html-0f729e2f.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-ded121db.js" as="script"><link rel="prefetch" href="/xjblog/assets/less.html-6a112481.js" as="script"><link rel="prefetch" href="/xjblog/assets/sass.html-0518d679.js" as="script"><link rel="prefetch" href="/xjblog/assets/scope.html-dc2a0b81.js" as="script"><link rel="prefetch" href="/xjblog/assets/tailwind.html-fa555d04.js" as="script"><link rel="prefetch" href="/xjblog/assets/bibao.html-aa4d620f.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-aa0f78e5.js" as="script"><link rel="prefetch" href="/xjblog/assets/js.html-16f95a24.js" as="script"><link rel="prefetch" href="/xjblog/assets/jstrash.html-8f9c2822.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-5672f6be.js" as="script"><link rel="prefetch" href="/xjblog/assets/waterfall.html-9c1634a7.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-5752af20.js" as="script"><link rel="prefetch" href="/xjblog/assets/g2.html-e7881cb2.js" as="script"><link rel="prefetch" href="/xjblog/assets/git.html-e83da039.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-2e88778c.js" as="script"><link rel="prefetch" href="/xjblog/assets/mongodb.html-a6bf983c.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt-Vuex.html-8a106ffb.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt笔记.html-e8b0231b.js" as="script"><link rel="prefetch" href="/xjblog/assets/print.html-70bb765a.js" as="script"><link rel="prefetch" href="/xjblog/assets/Regexp.html-4187ed5d.js" as="script"><link rel="prefetch" href="/xjblog/assets/uni-app.html-d71eedf1.js" as="script"><link rel="prefetch" href="/xjblog/assets/vuePress.html-93772d8e.js" as="script"><link rel="prefetch" href="/xjblog/assets/webpack.html-255e041e.js" as="script"><link rel="prefetch" href="/xjblog/assets/websocket.html-984bdb18.js" as="script"><link rel="prefetch" href="/xjblog/assets/xlsx.html-26dddaf0.js" as="script"><link rel="prefetch" href="/xjblog/assets/小程序.html-1cb9bfc3.js" as="script"><link rel="prefetch" href="/xjblog/assets/部署nuxt项目.html-8e91aa6c.js" as="script"><link rel="prefetch" href="/xjblog/assets/centOS-mysql.html-850f04a1.js" as="script"><link rel="prefetch" href="/xjblog/assets/CentOs安装mysql5.7.html-2b49dce8.js" as="script"><link rel="prefetch" href="/xjblog/assets/del_package_quick.html-8b384235.js" as="script"><link rel="prefetch" href="/xjblog/assets/express脚手架新建项目.html-7dcab6d9.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-d3f5453d.js" as="script"><link rel="prefetch" href="/xjblog/assets/nginx.html-10c449c2.js" as="script"><link rel="prefetch" href="/xjblog/assets/node-cors解决跨域.html-08172e34.js" as="script"><link rel="prefetch" href="/xjblog/assets/package.html-e473e5a6.js" as="script"><link rel="prefetch" href="/xjblog/assets/快速打包部署.html-d358c00c.js" as="script"><link rel="prefetch" href="/xjblog/assets/antd-antdPro.html-6a7ae3a2.js" as="script"><link rel="prefetch" href="/xjblog/assets/baiduMap.html-e87d3acf.js" as="script"><link rel="prefetch" href="/xjblog/assets/hooks.html-534d4e22.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-836ae580.js" as="script"><link rel="prefetch" href="/xjblog/assets/react.html-61eaccd6.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-4cdfc9c8.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-0c0b7c77.js" as="script"><link rel="prefetch" href="/xjblog/assets/defineProperty.html-4bef435b.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-d8eb0dd7.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue2.html-6b28cda9.js" as="script"><link rel="prefetch" href="/xjblog/assets/VUEX.html-2a509512.js" as="script"><link rel="prefetch" href="/xjblog/assets/doit.html-18a02ee2.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-ec34db96.js" as="script"><link rel="prefetch" href="/xjblog/assets/vite.html-6e541edd.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue3.html-71883397.js" as="script"><link rel="prefetch" href="/xjblog/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-79193353.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-ee9ad49b.js" as="script"><link rel="prefetch" href="/xjblog/assets/css.html-2632f8d2.js" as="script"><link rel="prefetch" href="/xjblog/assets/flex.html-bcc60680.js" as="script"><link rel="prefetch" href="/xjblog/assets/grid.html-c0d77b6f.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-1b532619.js" as="script"><link rel="prefetch" href="/xjblog/assets/less.html-e7c2724e.js" as="script"><link rel="prefetch" href="/xjblog/assets/sass.html-29c11444.js" as="script"><link rel="prefetch" href="/xjblog/assets/scope.html-974a15ec.js" as="script"><link rel="prefetch" href="/xjblog/assets/tailwind.html-8d6f667b.js" as="script"><link rel="prefetch" href="/xjblog/assets/bibao.html-8b5d798d.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-00337abd.js" as="script"><link rel="prefetch" href="/xjblog/assets/js.html-ea0159f7.js" as="script"><link rel="prefetch" href="/xjblog/assets/jstrash.html-06f6db05.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-e47e649a.js" as="script"><link rel="prefetch" href="/xjblog/assets/waterfall.html-880e6673.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-a6667085.js" as="script"><link rel="prefetch" href="/xjblog/assets/g2.html-43695f0c.js" as="script"><link rel="prefetch" href="/xjblog/assets/git.html-830e0175.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-12fda895.js" as="script"><link rel="prefetch" href="/xjblog/assets/mongodb.html-9f10db25.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt-Vuex.html-d7ed6d79.js" as="script"><link rel="prefetch" href="/xjblog/assets/nuxt笔记.html-454d6ded.js" as="script"><link rel="prefetch" href="/xjblog/assets/print.html-1526128e.js" as="script"><link rel="prefetch" href="/xjblog/assets/Regexp.html-154d4563.js" as="script"><link rel="prefetch" href="/xjblog/assets/uni-app.html-1b6c8f93.js" as="script"><link rel="prefetch" href="/xjblog/assets/vuePress.html-f439197d.js" as="script"><link rel="prefetch" href="/xjblog/assets/webpack.html-3db40d22.js" as="script"><link rel="prefetch" href="/xjblog/assets/websocket.html-471c4d54.js" as="script"><link rel="prefetch" href="/xjblog/assets/xlsx.html-6fc5e4a2.js" as="script"><link rel="prefetch" href="/xjblog/assets/小程序.html-2e6dd83c.js" as="script"><link rel="prefetch" href="/xjblog/assets/部署nuxt项目.html-93928afa.js" as="script"><link rel="prefetch" href="/xjblog/assets/centOS-mysql.html-25437a2a.js" as="script"><link rel="prefetch" href="/xjblog/assets/CentOs安装mysql5.7.html-ee2ed09e.js" as="script"><link rel="prefetch" href="/xjblog/assets/del_package_quick.html-c8d22e96.js" as="script"><link rel="prefetch" href="/xjblog/assets/express脚手架新建项目.html-8aa47212.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-001a74c5.js" as="script"><link rel="prefetch" href="/xjblog/assets/nginx.html-2f05dbc5.js" as="script"><link rel="prefetch" href="/xjblog/assets/node-cors解决跨域.html-a04990ab.js" as="script"><link rel="prefetch" href="/xjblog/assets/package.html-19bd02ab.js" as="script"><link rel="prefetch" href="/xjblog/assets/快速打包部署.html-3a8787b7.js" as="script"><link rel="prefetch" href="/xjblog/assets/antd-antdPro.html-1ea2c5ad.js" as="script"><link rel="prefetch" href="/xjblog/assets/baiduMap.html-0ccbf487.js" as="script"><link rel="prefetch" href="/xjblog/assets/hooks.html-9c82c248.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-b3e468a5.js" as="script"><link rel="prefetch" href="/xjblog/assets/react.html-e4bdddd2.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-5b07abd6.js" as="script"><link rel="prefetch" href="/xjblog/assets/TypeScript.html-2d31bf99.js" as="script"><link rel="prefetch" href="/xjblog/assets/defineProperty.html-7d615f56.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-e5888f37.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue2.html-3cb2c0f9.js" as="script"><link rel="prefetch" href="/xjblog/assets/VUEX.html-5673b687.js" as="script"><link rel="prefetch" href="/xjblog/assets/doit.html-2e9ab059.js" as="script"><link rel="prefetch" href="/xjblog/assets/index.html-b2898b86.js" as="script"><link rel="prefetch" href="/xjblog/assets/vite.html-296db80a.js" as="script"><link rel="prefetch" href="/xjblog/assets/vue3.html-099bbd0b.js" as="script"><link rel="prefetch" href="/xjblog/assets/404.html-bf3c2e2a.js" as="script"><link rel="prefetch" href="/xjblog/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/xjblog/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/xjblog/assets/index-82585c84.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/xjblog/" class=""><img class="logo" src="/xjblog/images/t.png" alt="XJ-Blog"><span class="site-name can-hide">XJ-Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/xjblog/html" class="" aria-label="Html"><!--[--><!--]--> Html <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/css" class="" aria-label="Css"><!--[--><!--]--> Css <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/js" class="" aria-label="Javascript"><!--[--><!--]--> Javascript <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/xjblog/vue2" class="" aria-label="Vue2"><!--[--><!--]--> Vue2 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/xjblog/vue3" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/xjblog/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/node" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/more" class="router-link-active" aria-label="更多"><!--[--><!--]--> 更多 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/xjblog/html" class="" aria-label="Html"><!--[--><!--]--> Html <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/css" class="" aria-label="Css"><!--[--><!--]--> Css <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/js" class="" aria-label="Javascript"><!--[--><!--]--> Javascript <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/xjblog/vue2" class="" aria-label="Vue2"><!--[--><!--]--> Vue2 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/xjblog/vue3" class="" aria-label="Vue3"><!--[--><!--]--> Vue3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/xjblog/react" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/node" class="" aria-label="Node.js"><!--[--><!--]--> Node.js <!--[--><!--]--></a></div><div class="navbar-item"><a href="/xjblog/more" class="router-link-active" aria-label="更多"><!--[--><!--]--> 更多 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/xjblog/more/Regexp.html" class="sidebar-item sidebar-heading" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/vuePress.html" class="sidebar-item sidebar-heading" aria-label="VuePress"><!--[--><!--]--> VuePress <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/uni-app" class="sidebar-item sidebar-heading" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/小程序.md" class="sidebar-item sidebar-heading" aria-label="微信小程序"><!--[--><!--]--> 微信小程序 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/mongodb.md" class="sidebar-item sidebar-heading" aria-label="mongodb"><!--[--><!--]--> mongodb <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/nuxt笔记.md" class="sidebar-item sidebar-heading" aria-label="nuxt.js"><!--[--><!--]--> nuxt.js <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/nuxt-Vuex.md" class="sidebar-item sidebar-heading" aria-label="nuxt Vuex持久化"><!--[--><!--]--> nuxt Vuex持久化 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/部署nuxt项目.md" class="sidebar-item sidebar-heading" aria-label="部署nuxt项目"><!--[--><!--]--> 部署nuxt项目 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#五层网络模型" class="router-link-active router-link-exact-active sidebar-item" aria-label="五层网络模型"><!--[--><!--]--> 五层网络模型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#http各版本" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP各版本"><!--[--><!--]--> HTTP各版本 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#http1-0" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP1.0"><!--[--><!--]--> HTTP1.0 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#http1-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP1.1"><!--[--><!--]--> HTTP1.1 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#http2-0" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTP2.0"><!--[--><!--]--> HTTP2.0 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#请求方法的本质" class="router-link-active router-link-exact-active sidebar-item" aria-label="请求方法的本质"><!--[--><!--]--> 请求方法的本质 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#get和post的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="get和post的区别"><!--[--><!--]--> get和post的区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#域名" class="router-link-active router-link-exact-active sidebar-item" aria-label="域名"><!--[--><!--]--> 域名 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#dns" class="router-link-active router-link-exact-active sidebar-item" aria-label="DNS"><!--[--><!--]--> DNS <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#cdn" class="router-link-active router-link-exact-active sidebar-item" aria-label="CDN"><!--[--><!--]--> CDN <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#http状态码" class="router-link-active router-link-exact-active sidebar-item" aria-label="http状态码"><!--[--><!--]--> http状态码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#content-type" class="router-link-active router-link-exact-active sidebar-item" aria-label="content-type"><!--[--><!--]--> content-type <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#cookie" class="router-link-active router-link-exact-active sidebar-item" aria-label="cookie"><!--[--><!--]--> cookie <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#cookie和storage的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="cookie和storage的区别"><!--[--><!--]--> cookie和storage的区别 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#session" class="router-link-active router-link-exact-active sidebar-item" aria-label="session"><!--[--><!--]--> session <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#加密" class="router-link-active router-link-exact-active sidebar-item" aria-label="加密"><!--[--><!--]--> 加密 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#对称加密" class="router-link-active router-link-exact-active sidebar-item" aria-label="对称加密"><!--[--><!--]--> 对称加密 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#非对称加密" class="router-link-active router-link-exact-active sidebar-item" aria-label="非对称加密"><!--[--><!--]--> 非对称加密 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#摘要-哈希-散列" class="router-link-active router-link-exact-active sidebar-item" aria-label="摘要/哈希/散列"><!--[--><!--]--> 摘要/哈希/散列 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#单点登录" class="router-link-active router-link-exact-active sidebar-item" aria-label="单点登录"><!--[--><!--]--> 单点登录 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#cookie实现单点登录" class="router-link-active router-link-exact-active sidebar-item" aria-label="cookie实现单点登录"><!--[--><!--]--> cookie实现单点登录 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#localstorage实现单点登录" class="router-link-active router-link-exact-active sidebar-item" aria-label="localstorage实现单点登录"><!--[--><!--]--> localstorage实现单点登录 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#jwt" class="router-link-active router-link-exact-active sidebar-item" aria-label="jwt"><!--[--><!--]--> jwt <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#无感刷新token" class="router-link-active router-link-exact-active sidebar-item" aria-label="无感刷新token"><!--[--><!--]--> 无感刷新token <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#编码解码" class="router-link-active router-link-exact-active sidebar-item" aria-label="编码解码"><!--[--><!--]--> 编码解码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#同源策略" class="router-link-active router-link-exact-active sidebar-item" aria-label="同源策略"><!--[--><!--]--> 同源策略 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#代理" class="router-link-active router-link-exact-active sidebar-item" aria-label="代理"><!--[--><!--]--> 代理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#cors" class="router-link-active router-link-exact-active sidebar-item" aria-label="CORS"><!--[--><!--]--> CORS <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#jsonp" class="router-link-active router-link-exact-active sidebar-item" aria-label="JSONP"><!--[--><!--]--> JSONP <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#xhr" class="router-link-active router-link-exact-active sidebar-item" aria-label="xhr"><!--[--><!--]--> xhr <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#事件" class="router-link-active router-link-exact-active sidebar-item" aria-label="事件"><!--[--><!--]--> 事件 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#fetch" class="router-link-active router-link-exact-active sidebar-item" aria-label="fetch"><!--[--><!--]--> fetch <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#request对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="Request对象"><!--[--><!--]--> Request对象 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#response对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="Response对象"><!--[--><!--]--> Response对象 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#headers对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="Headers对象"><!--[--><!--]--> Headers对象 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#xhr和fetch对比" class="router-link-active router-link-exact-active sidebar-item" aria-label="xhr和fetch对比"><!--[--><!--]--> xhr和fetch对比 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#请求中断" class="router-link-active router-link-exact-active sidebar-item" aria-label="请求中断"><!--[--><!--]--> 请求中断 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#文件上传" class="router-link-active router-link-exact-active sidebar-item" aria-label="文件上传"><!--[--><!--]--> 文件上传 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#文件下载" class="router-link-active router-link-exact-active sidebar-item" aria-label="文件下载"><!--[--><!--]--> 文件下载 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#断点续传" class="router-link-active router-link-exact-active sidebar-item" aria-label="断点续传"><!--[--><!--]--> 断点续传 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#浏览器输入url后" class="router-link-active router-link-exact-active sidebar-item" aria-label="浏览器输入url后"><!--[--><!--]--> 浏览器输入url后 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#http缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="http缓存"><!--[--><!--]--> http缓存 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/xjblog/more/network.html#强缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="强缓存"><!--[--><!--]--> 强缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#协商缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="协商缓存"><!--[--><!--]--> 协商缓存 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/xjblog/more/network.html#csrf攻击" class="router-link-active router-link-exact-active sidebar-item" aria-label="CSRF攻击"><!--[--><!--]--> CSRF攻击 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#xss攻击" class="router-link-active router-link-exact-active sidebar-item" aria-label="XSS攻击"><!--[--><!--]--> XSS攻击 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#网络性能优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="网络性能优化"><!--[--><!--]--> 网络性能优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#ssl、tls、https的关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="SSL、TLS、HTTPS的关系"><!--[--><!--]--> SSL、TLS、HTTPS的关系 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/xjblog/more/network.html#tcp的三次握手、四次挥手" class="router-link-active router-link-exact-active sidebar-item" aria-label="TCP的三次握手、四次挥手"><!--[--><!--]--> TCP的三次握手、四次挥手 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/xjblog/more/git.html" class="sidebar-item sidebar-heading" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/print.html" class="sidebar-item sidebar-heading" aria-label="打印"><!--[--><!--]--> 打印 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/g2.html" class="sidebar-item sidebar-heading" aria-label="g2"><!--[--><!--]--> g2 <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/xlsx.html" class="sidebar-item sidebar-heading" aria-label="xlsx"><!--[--><!--]--> xlsx <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/webpack.html" class="sidebar-item sidebar-heading" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a><!----></li><li><a href="/xjblog/more/websocket.html" class="sidebar-item sidebar-heading" aria-label="websocket"><!--[--><!--]--> websocket <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="五层网络模型" tabindex="-1"><a class="header-anchor" href="#五层网络模型" aria-hidden="true">#</a> 五层网络模型</h2><p><img src="/xjblog/assets/image-20240306154403387-a2a1a1dd.png" alt="image-20240306154403387"></p><ul><li>每层相对独立，只需解决自己的问题</li><li>每层无须考虑上层的交付，仅需把自己的结果交给下层即可</li><li>每层有多种方案可供选择，选择不同的方案不会对上下层造成影响</li><li>每一层会在上一层的基础上增加一些额外信息</li></ul><p>在发送消息时，消息从上到下进行打包，每一层会在上一层基础上加包，而接受消息时，从下到上进行解包，最终得到原始信息。</p><h2 id="http各版本" tabindex="-1"><a class="header-anchor" href="#http各版本" aria-hidden="true">#</a> HTTP各版本</h2><h3 id="http1-0" tabindex="-1"><a class="header-anchor" href="#http1-0" aria-hidden="true">#</a> HTTP1.0</h3><p>无法复用连接。http1.0为每个请求单独新开一个tcp连接</p><ul><li>连接的建立和销毁都会消耗时间，造成响应时间的浪费</li><li>无法充分利用带宽，造成带宽资源的浪费（TCP协议的特点是<strong>慢启动</strong>，即一开始传输的数据量少，一段时间后达到传输的峰值，然后htp1.0的做法会导致大量请求在tcp达到传输峰值前就被销毁）</li><li>队头阻塞，只有上一个请求完成时，下一个请求才能开始</li></ul><h3 id="http1-1" tabindex="-1"><a class="header-anchor" href="#http1-1" aria-hidden="true">#</a> HTTP1.1</h3><p>长连接：为了解决HTTP1.0的问题，<strong>HTTP1.1默认开启长连接</strong>，即让同一个TCP连接服务于多个请求-响应。多次请求响应可以共享同一个TCP连接，这不仅减少了TCP的握手和挥手时间，同时可以充分利用TCP「慢启动」的特点，有效的利用带宽。</p><p>实际上在HTTP1.0后期，虽然没有官方标准，但开发者们慢慢形成了一个共识：</p><p>只要请求头中包含<strong>Connection：keep-alive</strong>，就表示客户端希望开启长连接，希望服务器响应后不要关闭TCP连接。如果服务器认可这一行为，即可保持TCP连接。</p><p><strong>什么时候关闭连接？</strong></p><ul><li>客户端在某一次请求中设置了Connection：close，服务器收到此请求后，响应结束立即关闭TCP</li><li>在没有请求时，客户端会不断对服务器进行心跳检测（一般每隔1秒）。一旦心跳检测停止，服务器立即关闭TCP</li><li>当客户端长时间没有新的请求到达服务器，服务器会主动关闭TCP。运维人员可以设置该时间。</li></ul><p><strong>管道化与队头阻塞</strong></p><p><strong>管道化：<strong>允许客户端在单个 TCP 连接上发送多个请求，而</strong>无需等待前一个请求的响应</strong>。</p><p>即使可以在同一连接上发送多个请求，但这些请求和<strong>响应仍然必须按照顺序传输和处理，所以仍不能解决队头阻塞的问题</strong>。</p><p>如果前面的请求或响应因某种原因被阻塞或延迟，那么在同一连接上的后续请求也会被阻塞，无法被及时处理。</p><p>队头阻塞虽然发生在服务器，但这个问题的<strong>根源是客户端无法知晓服务器的响应是针对哪个请求的</strong></p><p>所以管道化是<strong>默认关闭</strong>的</p><h3 id="http2-0" tabindex="-1"><a class="header-anchor" href="#http2-0" aria-hidden="true">#</a> HTTP2.0</h3><p>http2.0必须运行在https之上。</p><p><strong>多路复用：<strong>HTTP2.0可以允许以更小的单元传输数据</strong>每个传输单元称之为帧</strong>，而每一个<strong>请求或响应的完整数据（行头体）称之为流</strong>，每个流有自己的编号，每个帧的头部都会记录所属的流。解决了队头阻塞问题，实现了真正的<strong>多路复用</strong>。不同的流可以交替传输，但是同一个流里的帧顺序不能打乱传输</p><p>多路复用简单来说就是通过引入帧(最小传输单位)和流(一个请求或响应)的概念，每个帧都有所属流的编号，即使是不同流交替传输，也可以区分，不会造成混乱，而http1.1的传输单元是整个响应文本，接收方必须按序接收才不会混乱</p><p>**头部压缩：**2.0之前，所有的消息头都是以字符的形式完整传输的，可实际上，大部分头部信息都有很多的重复。为了解决这一问题，HTTP2.0使用头部压缩来减少消息头的体积</p><p>核心思想是通过维护两个表来实现头部信息的压缩：动态表和静态表。</p><ul><li><p><strong>静态表</strong>：静态表包含了一组常见的头部信息，如常见的请求方法、响应状态码等。静态表中的头部信息是固定不变的，并且可以通过索引直接引用，无需重复传输。</p></li><li><p><strong>动态表</strong>：动态表是一个可以动态增长的表，用于存储最近发送或接收的头部信息。每当发送或接收一个新的头部信息时，如果该头部信息没有在动态表中出现过，则将其添加到动态表中；如果已经存在，则可以通过索引引用动态表中的已有信息。这种方式可以减少重复的头部信息的传输，提高压缩效率。</p></li></ul><p>**服务器推：**HTTP2.0允许在客户端没有主动请求的情况下主动推测发送相关资源，当客户端后续需要请求该资源时，则自动从之前推送的资源中寻找</p><p>比如客户端请求某个资源，如HTML页面，服务器接收到请求后，推测客户端可能需要其他的相关资源，如css、js文件、图片等，主动在客户端请求前，将这些相关资源发送给客户端，</p><h2 id="请求方法的本质" tabindex="-1"><a class="header-anchor" href="#请求方法的本质" aria-hidden="true">#</a> 请求方法的本质</h2><p>请求方法是<strong>请求行中的第一个单词</strong>，它向服务器描述了客户端发出请求的动作类型。</p><p>在HTTP协议中，不同的请求方法只是包含了不同的语义，但服务器和浏览器的一些约定俗成的行为造成了它们具体的区别</p><ul><li>GET，表示向服务器获取资源。业务数据在请求行中，无须请求体</li><li>POST，表示向服务器提交信息，通常用于产生新的数据，比如注册。业务数据在请求体中</li><li>PUT，表示希望修改服务器的数据，通常用于修改。业务数据在请求体中</li><li>DELETE，表示希望删除服务器的数据。业务数据在请求行中，无须请求体。</li><li>OTIONS，发生在跨域的预检请求中，表示客户端向服务器申请跨域提交</li><li>TRACE，回显服务器收到的请求，主要用于测试和诊断</li><li>CONNECT，用于建立连接管道，通常在代理场景中使用，网页中很少用到</li></ul><h2 id="get和post的区别" tabindex="-1"><a class="header-anchor" href="#get和post的区别" aria-hidden="true">#</a> get和post的区别</h2><p>1.浏览器在发送GET请求时，不会附带请求体，请求传递的参数都在path参数中，不宜传递敏感数据</p><p>2.GET请求的传递信息量有限（浏览器限制了请求头和请求行的大小），适合传递少量数据；POST请求的传递信息量是没有限制的，适合传输大量数据。</p><p>3.GET请求只能传递ASCII数据（也是浏览器限制了请求头和请求体），遇到非ASCII数据需要进行编码；POST请求没有限制</p><p>4.GET请求可以缓存，POST不能缓存（这可能是语义上导致的，约定熟成get是用来获取资源，对同一个资源的获取返回相同的结果理论上更适合缓存，而post是用作提交信息，改变服务器资源）</p><p>5.刷新页面时，如果当前页面是通过post请求得到的，浏览器会提示用户是否重新提交(<strong>返回此页可能需要重复已进行的所有操作</strong>)。如果是get请求得到的页面则没有这个提示</p><h2 id="域名" tabindex="-1"><a class="header-anchor" href="#域名" aria-hidden="true">#</a> 域名</h2><p>域名的作用是帮助我们记忆网站地址，有了域名就不用去记ip地址了</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>.com是顶级域名，baidu是二级域名，www是三级域名。一般来说，购买二级域名后，三级，四级域名都是可以免费自定义的</p><h2 id="dns" tabindex="-1"><a class="header-anchor" href="#dns" aria-hidden="true">#</a> DNS</h2><p>网络传输必须依靠IP，所以需要DNS服务器将域名转换成IP地址，这一过程叫<strong>域名解析</strong></p><p>解析过程：</p><ul><li>查找本机hosts文件中是否有解析记录，如果有，直接使用</li><li>查找本地域名服务器（局域网）中是否有解析记录，如果有，直接使用</li><li>查询根域名服务器，得到顶级域名服务器ip</li><li>查询顶级域名服务器中是否有解析记录，如果有，直接使用</li><li>根据顶级域名服务器反馈的ip，查询权限域名服务器，如果有解析记录，直接使用</li><li>如果以上都找不到，域名解析失败</li></ul><h2 id="cdn" tabindex="-1"><a class="header-anchor" href="#cdn" aria-hidden="true">#</a> CDN</h2><p>CDN （ContentDistributionNetwork，内容分发网络）是一种用于加速内容分发的网络服务。它通过<strong>将内容分发到追布全球的边缘节点服务器上</strong>，使用户访问时可以自动选择最近的节点，从而<strong>提高访问速度</strong>和用户体验。</p><h2 id="http状态码" tabindex="-1"><a class="header-anchor" href="#http状态码" aria-hidden="true">#</a> http状态码</h2><p>状态码第一位数字决定了不同的响应状态，如下：</p><ul><li>1 表示消息，需要请求者继续执行操作</li><li>2 表示成功</li><li>3 表示重定向</li><li>4 表示客户端错误，请求包含语法错误或无法完成请求</li><li>5 表示服务器错误，服务器在处理请求中发送错误</li></ul><p><strong>1xx</strong></p><p>代表请求已被接受，需要继续处理，这类响应是临时响应。</p><ul><li><p><strong>100</strong> <code>Continue </code>继续。临时响应是用来通知客户端请求已经被服务器接收，客户端应继续请求。</p></li><li><p><strong>101</strong> <code>Switching Protocols </code>切换协议。服务器根据客户端的请求切换协议，只能切换到更高级的协议。主要用于 <code>websocket</code> 或 <code>HTTP2</code> 升级</p></li></ul><p><strong>2xx</strong></p><p>代表请求已成功被服务器接收，处理，并接受。</p><ul><li>200 <code>OK</code> 请求成功。</li><li>201 <code>Created</code> 已创建。成功请求并创建了新的资源</li><li>202 <code>Accepted</code> 已接受。已经接受请求，但未处理完成</li><li>203 <code>Non-Authoritative Information</code> 非授权信息。请求成功。但返回的信息可能来自另一来源。</li><li>204 <code>No Content </code>无内容。服务器成功处理，但没有返回任何内容。</li><li>205 <code>Reset Content </code>重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域</li><li>206 <code>Partial Content </code>部分内容。服务器成功处理了部分 <code>GET</code> 请求</li></ul><p><strong>3xx</strong></p><p>表示要完成请求，需要进一步操作，通常这些状态代码用来重定向</p><ul><li><p>300 <code>Multiple Choices </code>多种选择。服务器可执行多种操作，相应可返回一个资源特征与地址的列表用于用户终端选择</p></li><li><p>301 <code>Moved Permanently</code> 永久移动。请求的资源已被永久的移动到新 <code>URI</code>，返回信息会包括新的 <code>URI</code>，浏览器会自动定向到新 <code>URI</code>。今后任何新的请求都应使用新的<code>URI</code>代替</p></li><li><p>302 <code>Found </code>临时移动。与 <code>301 </code>类似。但资源只是临时被移动。客户端应继续使用原有URI</p></li><li><p>303 <code>See Other</code> 查看其它地址。与<code> 301</code> 类似。使用 <code>GET</code> 和<code>POST</code>请求查看</p></li><li><p>304 <code>Not Modified</code> 未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源</p></li><li><p>305 <code>Use Proxy</code> 使用代理。所请求的资源必须通过代理访问</p></li><li><p>306 <code>Unused </code>已经被废弃的<code> HTTP</code> 状态码</p></li><li><p>307 <code>Temporary Redirect</code> 临时重定向。与 <code>302</code> 类似。使用 <code>GET </code>请求重定向</p></li></ul><p><strong>4xx</strong></p><p>代表了客户端请求发生了错误</p><ul><li><p>400 <code>Bad Request</code> 客户端请求的语法错误，服务器无法处理</p></li><li><p>401 <code>Unauthorized</code> 请求要求用户的身份认证</p></li><li><p>403 <code>Forbidden</code> 服务器拒绝执行此请求</p></li><li><p>404 <code>Not Found </code>服务器无法根据客户端的请求找到资源（网页）。</p></li><li><p>405 <code>Method Not Allowed</code> 客户端请求中的方法被禁止</p></li><li><p>406 <code>Not Acceptable</code> 服务器无法根据客户端请求的内容特性完成请求（服务器发送的格式不满足浏览器的规则）</p></li><li><p>407 <code>Proxy Authentication Required</code> 请求要求代理的身份认证，与 401 类似，但请求者应当使用代理进行授权</p></li><li><p>408 <code>Request Time-out</code> 服务器等待客户端发送的请求时间过长，超时</p></li><li><p>410 <code>Gone </code>客户端请求的资源已经不存在。410 不同于 404，如果资源以前有现在被永久删除了可使用 410 代码，网站设计人员可通过 301 代码指定资源的新位置</p></li></ul><p><strong>5xx</strong></p><p>表示服务器在处理请求的过程中有错误或异常状态发生</p><ul><li><p>500 <code>Internal Server Error</code> 服务器内部错误，无法完成请求</p></li><li><p>501 <code>Not Implemented </code>服务器不具备完成请求的功能，无法完成请求</p></li><li><p>502 <code>Bad Gateway</code> 作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应，<strong>网关错误</strong></p></li><li><p>503 <code>Service Unavailable</code> 服务器不可用，可能由于超载或系统维护，服务器暂时的无法处理客户端的请求</p></li><li><p>504 <code>Gateway Time-out </code>充当网关或代理的服务器，<strong>网关超时</strong>，未及时从远端服务器获取请求</p></li><li><p>505 <code>HTTP Version not supported</code> 服务器<strong>不支持请求的 <code>HTTP </code>协议</strong>的版本，无法完成处理</p></li></ul><p>从一个房间走到另一个房间，必然要经过一扇门。同样，从一个网络向另一个网络发送信息，也必须经过一道“关口”，这道关口就是网关。</p><h2 id="content-type" tabindex="-1"><a class="header-anchor" href="#content-type" aria-hidden="true">#</a> content-type</h2><p><strong>响应头的content-type</strong>，它告诉客户端接收到的数据的 MIME 类型（Multipurpose Internet Mail Extensions），从而帮助客户端正确地处理数据</p><p>可以通过mime来设置要上传的图片格式</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>常见的 MIME 类型包括：</p><ol><li><code>text/plain</code>: 指示文本文件，纯文本格式。浏览器会原封不动的显示到页面上</li><li><code>text/html</code>: 指示 HTML 文件，作为页面去渲染。 <code>text/html; charset=utf-8</code>: 指示 HTML 数据使用 UTF-8 字符编码。</li><li><code>text/javascript 或 application/javascript</code>: 浏览器会使用js引擎去解析执行</li><li><code>text/css</code>: 浏览器将它视为样式</li><li><code>application/json</code>: 指示 JSON 格式的数据。</li><li><code>application/xml</code>: 指示 XML 格式的数据。</li><li><code>image/jpeg</code>: 指示 JPEG 图像格式。</li><li><code>image/png</code>: 指示 PNG 图像格式。</li><li><code>image/gif</code>: 指示 GIF 图像格式。</li><li><code>application/pdf</code>: 指示 PDF 文件。</li><li><code>application/javascript</code>: 指示 JavaScript 文件。</li><li><code>application/octet-stream</code>: 指示二进制流数据，没有特定的文件格式或应用程序类型与之相关联。</li><li><code>audio/mpeg</code>: 指示 MP3 音频文件。</li><li><code>video/mp4</code>: 指示 MP4 视频文件</li></ol><p><strong>请求头的content-type</strong>用于指示请求体中数据的类型。它告诉服务器发送的数据的 MIME 类型，以便服务器能够正确地解析请求并处理数据</p><p>以下是常见的几种类型和传参格式</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://example.com/submit&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/x-www-form-urlencoded&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">&#39;username=test&amp;password=123&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//键值对通过=分隔，&amp;连接多个键值对</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//=============</span>
<span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加额外的数据到 FormData 对象</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;john@example.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://example.com/upload&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;multipart/form-data; boundary=----WebKitFormBoundaryxyz&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//分隔符会自动添加，不用自己配</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> formData<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//=============</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://example.com/api&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span>   <span class="token comment">// 还有个application/xml，xml数据类型用的比较少</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;value&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//============</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://example.com/submit&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token string">&#39;This is plain text data.&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cookie" tabindex="-1"><a class="header-anchor" href="#cookie" aria-hidden="true">#</a> cookie</h2><p>http协议是无状态的，就是http协议一旦完成请求就断开了，服务器不知道这一次请求的人，跟之前请求成功的人是不是同一个人，这时就需要服务器返回一个身份标识，cookie就是用来存储这个身份标识的。</p><p>客户端收到cookie会<strong>自动记录</strong>，并在符合条件的请求中自动附带在请求头中</p><p>组成：</p><ul><li>key：键</li><li>value: 值</li><li>domain：域，表示这个cookie是属于哪个网站的</li><li>path：路径，表示这个cookie是属于该网站哪个路径的</li><li>secure：是否使用安全传输</li><li>expire：过期时间</li></ul><p>如果一个cookie同时满足以下条件，则这个cookie会被附带到请求中</p><ul><li><strong>cookie没有过期</strong></li><li>cookie中的域和这次请求的<strong>域是匹配的</strong>。 <ul><li>如果cookie中的域是a.tech(主域)，则可以匹配的请求域是a.tech、www.a.tech(子域)、blogs.a.tech(子域)等等</li><li>如果cookie中的域是www.a.tech，则只能匹配 www.a.tech 这样的请求域</li><li>cookie是不在乎端口的，只要域匹配即可</li></ul></li><li>cookie中的path和这次请求的<strong>path是匹配的</strong><ul><li>比如cookie中的path是/news，则可以匹配的请求路径可以是/news/news/detail 、 /news/a/b/c 等等，但不能匹配 /blog</li><li>如果cookie的path是/，可以想象，能够匹配所有的路径</li></ul></li><li><strong>验证cookie的安全传输</strong><ul><li>如果cookie的<strong>secure属性是true</strong>，则请求协议<strong>必须是https</strong>，否则不会发送该cookie</li><li>如果cookie的<strong>secure属性是false</strong>，则请求协议<strong>可以是http</strong>，<strong>也可以是https</strong></li></ul></li></ul><p>cookie一般都是由服务器在响应头中返回，格式如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Set-Cookie: <span class="token assign-left variable">xxx</span><span class="token operator">=</span>xxx<span class="token punctuation">;</span>

<span class="token comment"># cookie格式：除了键值，其他都是可选的</span>
键<span class="token operator">=</span>值：path<span class="token operator">=</span>？<span class="token punctuation">;</span><span class="token assign-left variable">domain</span><span class="token operator">=</span>？<span class="token punctuation">;</span><span class="token assign-left variable">expire</span><span class="token operator">=</span>？<span class="token punctuation">;</span>max-age<span class="token operator">=</span>?<span class="token punctuation">;</span>secure<span class="token punctuation">;</span>httponly
<span class="token comment"># domain最多可设置到自己的主域，不设置默认为当前的请求域</span>

<span class="token comment"># expire设置的是GMT格式的过期时间</span>

<span class="token comment"># max-age设置的是相对过期时间，比如1000，就是1000s过期</span>

<span class="token comment"># expire和max-age设置其中一个即可，如果两个都没有设置，则会话结束过期</span>

<span class="token comment"># httponly 如果段置了该值，表示该cookie仅能用于传输，而不允许在客户端通过JS获取，这对防止跨站脚本攻击（XSS）会很有用</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>浏览器设置cookie</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span><span class="token string">&quot;键=值；path=？；domain=？；expire=？；max-age=？；secure&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="cookie和storage的区别" tabindex="-1"><a class="header-anchor" href="#cookie和storage的区别" aria-hidden="true">#</a> cookie和storage的区别</h3><p>cookie不设置时效时和sessionStorage一样都是会话关闭就过期</p><p>cookie兼容性较好</p><p>浏览器会自动保存响应头里的cookie，并在下次请求时自动携带。而storage的需要手动保存和手动携带</p><p>cookie存储空间只有几kb，storage有5mb左右</p><p>cookie和domain、path关联，storage只和domain关联</p><h2 id="session" tabindex="-1"><a class="header-anchor" href="#session" aria-hidden="true">#</a> session</h2><p>这里的session不是指sessionStorage,session一般用于存储些短期需要的敏感数据，比如验证码校验、登录状态存储等</p><p>总会有不方便传递的隐私数据，此时就需要把验证数据存放在服务器。</p><p>session也是一个键值对，可以用数据库存，也可以用内存</p><p><strong>如何消除session</strong></p><ul><li>过期时间：当客户端长时间没有传递sessionid过来时，服务器可以在过期时间之后自动清除session</li><li>客户端主动通知：可以使用js监听客户端页面关闭或其他退出操作，然后通知服务器清除session</li></ul><p><strong>cookie和session的区别</strong></p><ul><li>cookie保存在客户端，session保存在服务端</li><li>cookie只能保存字符串，session可以保存任何类型的数据</li></ul><h2 id="加密" tabindex="-1"><a class="header-anchor" href="#加密" aria-hidden="true">#</a> 加密</h2><h3 id="对称加密" tabindex="-1"><a class="header-anchor" href="#对称加密" aria-hidden="true">#</a> 对称加密</h3><p>明文+密钥+算法=密文</p><p>密文+密钥+算法=明文</p><p>即发送端和接收端用<strong>同一密钥加密和解密</strong></p><p>缺点：客户端也需要密钥进行解密，有泄露风险</p><h3 id="非对称加密" tabindex="-1"><a class="header-anchor" href="#非对称加密" aria-hidden="true">#</a> 非对称加密</h3><p>明文+公钥+算法=密文</p><p>密文+私钥+算法=明文</p><p>优点：安全，<strong>用私钥加密的数据，只有对应的公钥才能解密，用公钥加密的数据， 只有对应的私钥才能解密。</strong></p><h3 id="摘要-哈希-散列" tabindex="-1"><a class="header-anchor" href="#摘要-哈希-散列" aria-hidden="true">#</a> 摘要/哈希/散列</h3><p>明文+算法=密文</p><p>常见算法：md5、sha1</p><p>优点：密文占用空间小（定长的字符串），难以被破解</p><p>缺点：无法解密</p><h2 id="单点登录" tabindex="-1"><a class="header-anchor" href="#单点登录" aria-hidden="true">#</a> 单点登录</h2><p>有些公司产品线很多，可能有系统A、B或更多，它不可能为每一套系统单独做一套用户管理，那么就会把用户系统抽离出来形成一个认证中心。</p><p>常见的有两种模式，session+cookie或token</p><p><strong>session+cookid</strong>：用户登录后<strong>认证中心</strong>从cookie中返回单独的sid，认证中心也会单独存放一个session表格来后续验证（表格里有这个sid就证明已经登录，没有就是没登录或已过期）。后面用户请求子系统都会在cookie中携带sid，但子系统也没有辨别能力，它也需要发给认证中心</p><p>优势：认证中心完全掌控用户的状态，想让用户退出直接删除对应的sid</p><p>劣势：认证中心开销大，每个子系统都要来请求</p><p>**token:**用户登录后认证中心返回一个token，客户端存放。后续请求子系统时通过请求头携带token，子系统可以自己认证</p><p>优势：认证中心压力小</p><p>劣势：失去了用户的掌控，因为认证都在子系统进行，要让用户下线需要同步多个系统的信息。</p><p>解决思路：双token。登录后返回两个token，一个时间短一个时间长，请求子系统的时候带的是短token，当子系统的短token认证过期时，先去认证中心刷新短token，这样认证中心就重新掌握了用户的状态</p><h3 id="cookie实现单点登录" tabindex="-1"><a class="header-anchor" href="#cookie实现单点登录" aria-hidden="true">#</a> <strong>cookie实现单点登录</strong></h3><p><strong>父域 Cookie</strong></p><p>token通过cookie返回写入顶级域名，这样子域名都能访问到</p><p><strong>跨域认证中心</strong></p><p>用户统一<strong>在认证中心进行登录</strong>，登录成功后，认证中心记录用户的登录状态，并将 Token 写入 Cookie。（注意这个 <strong>Cookie 是认证中心的</strong>，应用系统是访问不到的）</p><p>应用系统检查当前请求有没有 Token，如果没有，说明用户在当前系统中尚未登录，那么就将页面跳转至认证中心进行登录。由于这个操作会将认证中心的 Cookie 自动带过去，因此，认证中心能够根据 Cookie 知道用户是否已经登录过了</p><p>如果认证中心发现用户尚未登录或验证失败，则返回登录页面</p><p>如果验证成功，会跳转回目标 URL ，并在跳转前生成一个 Token，拼接在目标 URL 的后面，回传给目标应用系统。</p><p>应用系统拿到 Token 之后，还需要向认证中心确认下 Token 的合法性，防止用户伪造</p><h3 id="localstorage实现单点登录" tabindex="-1"><a class="header-anchor" href="#localstorage实现单点登录" aria-hidden="true">#</a> localstorage实现单点登录</h3><p>众所周知localstorage是有同源限制的，无法跨域访问，那到底要怎么实现呢？</p><p>网上看到最多的就是iframe+postmessage实现传递localstorage，但是<em>Chrome115</em>后增加了storage的分区控制，会导致这种方案失败</p><h2 id="jwt" tabindex="-1"><a class="header-anchor" href="#jwt" aria-hidden="true">#</a> jwt</h2><p>全称JsonWebToken，它要解决的问题，就是在互联网环境中，提供统一的、安全的令牌格式</p><p>jwt只是一个令牌格式，由服务端生成，可以使用任何方式(cookie、响应头、响应体)传输jwt，服务端一般会放到响应头，</p><p>客户端拿到后可以储存在任意位置，在需要发送请求时放到请求头</p><p>通常在请求头的格式是这样的，具体也是视服务端要求</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">authorization</span><span class="token operator">:</span>bearer jwt令牌
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>令牌的组成</strong></p><ol><li>header：令牌头部，记录整个令牌的类型和签名算法</li><li>payload：令牌负荷，记录了保存的主体信息，比如要保存的用户信息</li><li>signature：令牌签名，按头部固定的签名算法对整个令牌进行签名，该签名的作用是保证令牌不被伪造和篡改</li></ol><p>组合后的完整格式：<strong>header.payload.signature</strong>,例子如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span class="token punctuation">.</span>eyJmb28i0iJiYXIiLCJpYXQi0jE10Dc1NDgyMTV9<span class="token punctuation">.</span>BCwUy3jnUQ_E6TqCayc7rCHkx<span class="token operator">-</span>vxxdagUwPOWqwYCFc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>header</strong>:eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</li></ul><p>header的格式是个json字符串，经过base64 url编码变成上面的样子。<strong>base64 url</strong>是在<strong>base64</strong>算法基础上对**+、=、/三个字符做出特殊处理的算法**</p><p>base64是使用64个可打印字符来表示一个二进制数据,0~9（10个）、a~z（26个）、A~Z（26个）、+(替换为-)、/(替换为_)、=（替换为空字符串。做填充位，实际是65个）</p><p>base64无法转换字符串中的中文</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//浏览器里提供函数可转换成base64</span>
<span class="token function">btoa</span><span class="token punctuation">(</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">)</span>

<span class="token comment">//可将base64转换回来</span>
<span class="token function">atob</span><span class="token punctuation">(</span><span class="token string">&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&#39;</span><span class="token punctuation">)</span>  <span class="token comment">//{&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>alg表示signature使用的签名算法，通常可取两个值</p><ul><li>HS256：一种对称加密算法</li><li>RS256：一种非对称加密算法</li></ul><p>typ表示整个令牌类型，通常固定写JWT</p><ul><li><strong>payload</strong>:eyJmb28i0iJiYXIiLCJpYXQi0jE10Dc1NDgyMTV9</li></ul><p>主体信息仍然是json字符串经base64 url编码转换得到，敏感信息不应加到这里，因为并不是加密。</p><ul><li><strong>signature</strong>:BCwUy3jnUQ_E6TqCayc7rCHkx-vxxdagUwPOWqwYCFc</li></ul><p>这一部分是对前面两个部分的编码结果，按照header指定的方式进行加密。</p><p>由于签名的密钥保存在服务器，所以客户端无法伪造签名。</p><p>前两部分并没有加密，只是一个编码的结果，可以认为是明文传输</p><p>jsonwebtoken库使用：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;jsonwebtoken&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// jwt.sign(payload, secretOrPrivateKey, [options, callback])   加密</span>
<span class="token comment">// jwt.verify(token, secretOrPublicKey, [options, callback])    解密</span>

<span class="token keyword">const</span> secret <span class="token operator">=</span> <span class="token string">&#39;test&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 签名密钥</span>
<span class="token comment">//生成token</span>
<span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        account<span class="token punctuation">,</span>
        <span class="token literal-property property">exp</span><span class="token operator">:</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span>  <span class="token comment">//exp字段可以设定过期时间,这里为1小时</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    account
 <span class="token punctuation">}</span><span class="token punctuation">,</span>secret<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>   <span class="token comment">//第二种设置过期时间方法，这是10秒.还有1m,1h,2d</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="无感刷新token" tabindex="-1"><a class="header-anchor" href="#无感刷新token" aria-hidden="true">#</a> 无感刷新token</h3><p>用户期望在使用应用程序时能顺畅进行，不受频繁登录或突然登出的干扰。</p><p>Token无感知刷新机制允许系统在访问令牌<strong>即将到期时</strong>，无需用户介入，自动使用刷新令牌获取新的访问令牌。这样，用户的操作不会因认证过期而中断</p><p><strong>1.请求拦截法</strong></p><p>实现主要依赖于客户端与服务器端的协作。</p><ol><li><strong>获取AccessToken和RefreshToken</strong>：在用户认证成功后，后端应返回AccessToken供客户端用于之后的请求验证，并同时返回RefreshToken用于在AccessToken即将过期时获取新的AccessToken</li><li><strong>判断Token是否即将过期</strong>：客户端<strong>需要一种机制来判断AccessToken是否即将过期</strong>。这可以通过后端<strong>返回的token失效时间来实现</strong>，例如设置一个阔值（如距离过期两小时），当达到这个条件时，<strong>客户端主动请求token刷新接口去获取一个新的token</strong></li><li><strong>挂起请求与重试</strong>：在发起请求前，客户端应拦截每个请求，检查AccessToken的有效性。如果检测到Token即将过期或已过期，系统会暂停当前请求，先进行Token刷新操作，再继续之前的请求。这样可以节省不必要的请求和流量。</li><li><strong>安全性和一致性</strong>：需要注意的是，如果依赖后端提供的token过期时间字段，则也考验客户端本地时间的准确性。如果本地时间被篡改，尤其是比服务器时间慢，那么拦截可能会失败。因此，建议使用相对时间而非绝对时间来处理Token的有效期(<strong>通过相对时间计算过期的绝对时间</strong>)</li></ol><p><strong>2.响应拦截法</strong></p><p><strong>响应结果拦截</strong>：不预先检查Token的有效期，而是在收到后端因Token过期而返回的错误响应（如状态码为401）后，再进行Token的刷新操作。刷新完成后，使用新的Token重新发起之前的请求</p><p>感觉最好还是让后端根据用户活跃度动态设置token时效</p><p><strong>token还没有刷新完成时，发送了其他请求需要如何处理</strong></p><p><strong>请求被拒绝</strong>：如果服务端检查到 token 已经过期，它可能会返回一个 401 Unauthorized 或者类似的错误状态码,</p><p>为了处理这些情况，你可以采取以下策略:</p><ul><li>状态管理：在 token刷新期间，你可以将应用的状态设置为&quot;正在刷新 token&quot;，并禁止发送新的请求，把要发送的请求存储起来，直到获取到新的 token。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//刷新token函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">refreshToken</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/refresh&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">token</span><span class="token operator">:</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;auth_token&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> waitingQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;auth_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token <span class="token operator">=</span> token<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//返回配置的对象</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//响应拦截器</span>
request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> config<span class="token punctuation">,</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> error<span class="token punctuation">.</span>response<span class="token punctuation">;</span> <span class="token comment">//config是在请求过程中出现错误时的请求配置信息</span>

      <span class="token comment">//正在刷新，把这些失败的请求推到任务队列中，等到</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        waitingQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          config<span class="token punctuation">,</span>
          resolve<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;/refresh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//也可以不通过url，给请求示例添加一个属性用于判断该请求是否是刷新token的请求</span>
      isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">//排除refresh，即刷新token失败时不再继续刷新</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        waitingQueue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> config<span class="token punctuation">,</span> resolve <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">request</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//重新发起刷新token过程中401的请求</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        waitingQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//重新发起这个失败的请求</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//refreshToken也过期，跳转登录页</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//其他错误处理</span>
      <span class="token keyword">return</span> error<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> request<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实这个方案也不算完美，但是基本把能解决的问题解决了。</p><p>什么解决不了呢？比如：（完全按照上面的代码逻辑）</p><p>并发三个请求，第一个返回401，去刷新token，期间第二个请求已经返回401，然后进入了isRefreshing的代码块中挂起。第三个请求仍未返回</p><p>新token已获取，重新请求第一个请求并且遍历请求挂起的请求队列。</p><p>此时第三个请求终于返回了401，而此时isRefreshing早变为了true，所以它又跑去刷新token了，这就造成了两次刷新token的结果，不过这也是因为第三个请求返回时间过长导致的，暂时不觉得前端有其他方案可以解决这个问题</p><h2 id="编码解码" tabindex="-1"><a class="header-anchor" href="#编码解码" aria-hidden="true">#</a> 编码解码</h2><p>上述jwt提到了base64编码转换</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">btoa</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span>   <span class="token comment">//将字符串转换为base64编码格式</span>

<span class="token function">atob</span><span class="token punctuation">(</span>xxx<span class="token punctuation">)</span>   <span class="token comment">//将base64编码转换为原始字符串</span>

<span class="token comment">//btoa要处理非 ASCII 字符，需要先将其转换为 UTF-8 编码的字节数组，再进行 Base64 编码</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&#39;你好 世界&#39;</span>
<span class="token keyword">const</span> utf8Bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token keyword">const</span> encodedStr <span class="token operator">=</span> <span class="token function">btoa</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token operator">...</span>utf8Bytes<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>encodedStr<span class="token punctuation">)</span> <span class="token comment">// 5L2g5aW9IOS4lueVjA==</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里再补充一下encodeURI 和 encodeURIComponent，它们都是 JavaScript 中用于对URL进行编码的内置函数，将非 ASCII 字符转换为 UTF-8 编码（即%加上两个十六进制数字）输出</p><ul><li><strong>encodeURI</strong> 用于编码整个URI，它不会对 URI 中具有特殊含义的字符进行编码，例如冒号（:）、正斜线（/）、问号（?）和井号（#）等</li><li><strong>encodeURIComponent</strong> 用于编码 URI 中的组成部分，它将<strong>编码所有非字母数字字符</strong>，包括某些URI组件中具有特殊含义的字符</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;https://example.com/search?q=foo bar&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> encodedUrl <span class="token operator">=</span> <span class="token function">encodeURI</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> encodedComponent <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>encodedUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 输出: &quot;https://example.com/search?q=foo%20bar&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>encodedComponent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: &quot;https%3A%2F%2Fexample.com%2Fsearch%3Fq%3Dfoo%20bar&quot;</span>

<span class="token comment">//decodeURI、decodeURIComponent就是用于url解码，把UTF-8 编码的十六进制表示转换回原始字符</span>
<span class="token function">decodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="同源策略" tabindex="-1"><a class="header-anchor" href="#同源策略" aria-hidden="true">#</a> 同源策略</h2><p>同源策略是浏览器出于安全考虑，对跨域的资源访问做出的限制，<strong>源=协议+主机+端口</strong>，三者有一个不同即为跨域</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">link</span><span class="token operator">:</span>href   
<span class="token literal-property property">script</span><span class="token operator">:</span>src
<span class="token literal-property property">img</span><span class="token operator">:</span>src
localstorage
ajax
<span class="token comment">//以上都会产生跨域问题,但对ajax的限制程度最高</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>即使跨域了，实际上请求已经发出且是有响应的，不过是浏览器给拦截了</p><p>解决跨域：</p><ul><li><strong>代理</strong>（常用）</li><li><strong>CORS</strong>（常用）</li><li>JSONP</li></ul><h3 id="代理" tabindex="-1"><a class="header-anchor" href="#代理" aria-hidden="true">#</a> 代理</h3><p>脚手架中配置的代理通常是脚手架开启一个服务端，我们所<strong>配置的请求</strong>的接口<strong>由这个代理服务器进行转发</strong>并返回结果</p><p>由于代理服务器是在服务器端进行通信的，而不是在浏览器中，因此不会受到浏览器的同源策略的限制</p><h3 id="cors" tabindex="-1"><a class="header-anchor" href="#cors" aria-hidden="true">#</a> CORS</h3><p>CORS是基于<strong>http1.1</strong>的一种跨域解决方案，它的全称是Cross-0riginResource-Sharing，跨域资源共享。</p><p>它的总体思路是：如果浏览器要跨域访问服务器的资源，需要获得服务器的允许</p><p>这个只能由后端来设置</p><p>CORS的基本理念是：</p><ul><li>只要服务器明确表示允许，则校验通过</li><li>服务器明确拒绝或没有表示，则校验不通过</li></ul><p>针对不同的请求，CORS规定了三种不同的交互模式，分别是：</p><ul><li>简单请求</li><li>需要预检的请求</li><li>附带身份凭证的请求</li></ul><h3 id="jsonp" tabindex="-1"><a class="header-anchor" href="#jsonp" aria-hidden="true">#</a> JSONP</h3><p>JSONP的做法是：当需要跨域请求时，不使用AJAX，转而<strong>生成一个script元素去请求服务器</strong>，由于<strong>浏览器并不阻止script元素的请求</strong>，这样请求可以到达服务器。服务器拿到请求后，<strong>响应一段JS代码</strong>，这段代码实际上是一个函数调用，<strong>调用的是客户端预先生成好的函数</strong>(如下面的callabck函数)，并把浏览器需要的数据作为参数传递到函数中，从而间接的把数据传递给客户端</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> callback（resp<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> request（url<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span>createElement（<span class="token string">&#39;script&#39;</span>）<span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendchild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//请求后浏览器返回调用callback的js代码，并带有所需的参数</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>缺点是只支持get请求</p><p><strong>简单请求</strong></p><p>简单请求的判定，<strong>同时满足以下条件</strong>，浏览器会认为它是一个简单请求：</p><p>1.请求方法属于以下的一种：<strong>get、post、head</strong></p><p>2.请求头仅包含安全的字段，只要不随便修改请求头，一般都满足</p><p>3.请求头如果包含Content-Type，仅限下面的值之一：</p><ul><li>text/plain</li><li>multipart/form-data</li><li>application/x-www-form-urlencoded</li></ul><p>当浏览器判定请求为简单请求时，它会<strong>自动给请求头加上origin字段</strong>，表明哪个源地址在请求</p><p>当<strong>服务器</strong>收到请求后，如果允许该请求跨域访问，需要在<strong>响应头中添加Access-Control-Allow-Origin</strong>字段，该字段如果是*，则表示对所有人开放，也可能是特定具体的源</p><p><strong>预检请求</strong></p><p>当浏览器发现不是一个简单请求时，它会<strong>先发送预检请求</strong>，询问服务器是否允许</p><p>预检请求有以下特征：</p><ul><li>请求方法为OPTIONS</li><li>没有请求体</li><li>请求头中包含 <ul><li>Origin：请求的源，和简单请求的含义一致</li><li>Access-Control-Request-Method：后续的真实请求将使用的请求方法</li><li>Access-Control-Request-Headers：后续的真实请求会改动的请求头</li></ul></li></ul><p>服务器收到预检请求，如果允许，需要在响应头添加：</p><ul><li>Access-Control-Allow-0rigin：和简单请求一样，表示允许的源</li><li>Access-Control-Allow-Methods：表示允许的后续真实的请求方法</li><li>Access-Control-Allow-Headers：表示允许改动的请求头</li><li>Access-Control-Max-Age：告诉浏览器，多少秒内，对于同样的请求源、方法、头，都不需要再发送预检请求了</li></ul><p>预检被允许后，浏览器会发送真实请求</p><p>如果是预检请求，打开f12的network模块，可以看到method列会有<strong>请求方法+Preflight</strong></p><p><strong>附带身份凭证的请求</strong></p><p>默认情况下，ajax 的跨域请求并不会附带cookie，需要一些改动</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//xhr</span>
<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
xhr<span class="token punctuation">.</span>withcredentials <span class="token operator">=</span> <span class="token boolean">true</span>


<span class="token comment">//fetch</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>
	<span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&#39;include&#39;</span>，
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样一来，该跨域的 ajax 请求就是一个附带身份凭证的请求</p><p>而服务器响应时，需要明确告知客户端：服务器允许这样的凭据</p><p>告知的方式也非常的简单，只需要在<strong>预检时响应头中添加：Access-Control-Allow-Credentials:true</strong>即可</p><p>对于一个附带身份凭证的请求，<strong>若服务器没有明确告知，浏览器仍然视为跨域被拒绝</strong></p><p><strong>注意</strong>：对于附带身份凭证的请求，服务器不得设置Access-Control-Allow-Origin的值为*。这就是为什么不推荐使用*的原因</p><p>在跨域访问时，JS 只能拿到一些最基本的响应头，如：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma, 如果要访问其他头,则需要服务器设置本响应头。<strong>Access-Control-Expose-Headers 响应头</strong>让服务器把允许浏览器访问的头放入白名</p><h2 id="xhr" tabindex="-1"><a class="header-anchor" href="#xhr" aria-hidden="true">#</a> xhr</h2><p>XMLHttpRequest（XHR）是一个 JavaScript 对象，它可以用来向服务器发送 HTTP 请求，从而实现网页的局部更新。是 AJAX 编程的核心技术。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">//创建实例</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//创建请求</span>

<span class="token comment">//-----不太常用的api</span>
xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span>mimeType<span class="token punctuation">)</span>   <span class="token comment">// overrideMimeType() 方法必须在 send() 方法之前调用</span>
<span class="token comment">//-----</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//设置请求头的值，必须在 open() 方法和 send() 方法之间调用   </span>
<span class="token comment">//如xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);是一个个header属性，而不是那种设置整个header</span>
xhr<span class="token punctuation">.</span>timeout<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">;</span> <span class="token comment">//过期时间,默认为0无过期时间</span>

<span class="token keyword">var</span> contentType<span class="token operator">=</span>xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//获取响应头</span>


xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>    <span class="token comment">//发送请求  body，可选参数，在 XHR 请求中要发送的数据体</span>
xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//终止该请求。当一个请求被终止，它的 readyState 将被置为 XMLHttpRequest.UNSENT (0)，并且请求的 status 置为 0。</span>

<span class="token comment">//监听响应处理</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果响应状态码为 200，表示请求成功</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;请求成功:&#39;</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出响应数据</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;请求失败:&#39;</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果响应状态码非 200，表示请求失败</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>method</strong>：HTTP 方法，比如 <code>GET</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code>、等</li><li><strong>url</strong>：发送请求的 URL</li><li>async：可选，是否为异步，默认为true，如果值为 <code>false</code>，<code>send()</code> 方法直到收到答复前不会返回。</li><li>user：可选，用户名用于认证用途；默认为 nul</li><li>password ：可选，密码用于认证用途</li></ul><p>一些常见的 MIME 类型：text/html，text/plain，text/css，text/javascript，application/json，application/xml，image/jpeg，image/png</p><h3 id="事件" tabindex="-1"><a class="header-anchor" href="#事件" aria-hidden="true">#</a> 事件</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// onxxx或addEventListener监听都可以</span>

<span class="token comment">//监听响应处理。onload事件在整个请求加载完成后触发</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果响应状态码为 200，表示请求成功</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;请求成功:&#39;</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出响应数据</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;请求失败:&#39;</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果响应状态码非 200，表示请求失败</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//监听请求状态变化。onreadystatechange 事件在 xhr 对象的 readyState 属性发生变化时触发</span>
<span class="token comment">/*
包括未初始化（0）：已创建但未调用open或请求被种植
已打开（1）：open() 方法已被调用，但 send() 方法尚未被调用
已收到响应头（2）：send() 方法已经被调用，响应头部信息已经收到并可以访问，但响应主体尚未接收
接收中（3）：响应主体正在接收。部分响应主体已经接收到，可以通过 responseText 属性访问部分数据
完成（4）：请求完成
*/</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//判断请求是否完成（readyState为4）并且成功（status为200）</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//在这里处理返回的数据，比如显示在网页上</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> resJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span>  <span class="token comment">//xhr.responseType默认为字符串，所以要转换，可在open前设置 xhr.responseType=&quot;json&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 监控请求发送进度,progress事件是在数据传输过程中周期性触发，并不是每传输一个数据包触发一次，所以并非100%实时，但这足够向用户反映进度。</span>
xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;progress&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">//upload对象是xhr实例中的属性，它用于表示上传的进程</span>
  <span class="token comment">// loaded属性代表已经传输的数据量，total代表需要传输的总数据量。</span>
  <span class="token comment">// 单位是字节</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>loaded<span class="token punctuation">,</span> e<span class="token punctuation">.</span>total<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>loaded <span class="token operator">/</span> e<span class="token punctuation">.</span>total <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;%&#39;</span> <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//监控响应进度</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;progress&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>loaded<span class="token punctuation">,</span> e<span class="token punctuation">.</span>total<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>loaded <span class="token operator">/</span> e<span class="token punctuation">.</span>total <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;%&#39;</span> <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;发生错误&#39;</span><span class="token punctuation">,</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onabort</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;请求被中断&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;请求超时&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onloadstart</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当请求开始加载时触发,即当 send() 方法被调用后立即触发</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onloadend</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当请求结束时触发，无论请求成功、失败还是被中断</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fetch" tabindex="-1"><a class="header-anchor" href="#fetch" aria-hidden="true">#</a> fetch</h2><p>XMLHttpRequest的问题</p><ul><li>所有的功能全部集中在同一个对象上，不利于分割模块</li><li>用传统的事件驱动模式，无法适配新的PromiseApi</li></ul><p>Fetch Api的特点：</p><ul><li>精细的功能分隔：头部信息、请求信息、响应信息等均分布到不同的对象，更利于处理各种复杂的AJAX场景</li><li>使用Promise Api，更利于异步代码的书写</li><li>Fetch Api属于HTML5新增的Web api，而非es6的内容</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> url<span class="token operator">=</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">&#39;cors&#39;</span><span class="token punctuation">,</span><span class="token comment">//请求模式，默认cors跨域，会在请求头中加入origin和referer.还有个no-cors、same-origin(请求其他域会报错)</span>
    <span class="token literal-property property">credentials</span><span class="token operator">:</span><span class="token string">&#39;include&#39;</span><span class="token punctuation">,</span><span class="token comment">//如何携带cookie，默认omit不携带，same-origin请求同源地址时携带，include请求任何地址都携带cookie</span>
    <span class="token literal-property property">cache</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span><span class="token comment">//no-store表示不使用缓存，且响应后不会更新缓存。no-cache也是不使用缓存，但响应后更新缓存.reload和no-cache差别不大</span>
    <span class="token comment">//force-cache表示即使缓存过期也使用缓存。only-if-cached在force-cache的基础上，如果没有缓存，直接抛出网络错误（该设置只有mode为same-origin时有效）</span>
<span class="token punctuation">}</span>

<span class="token comment">//只有网络出错或参数配置错误时，promise才会返回rejected</span>
<span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//config选填   第一个await等待的是请求响应头,响应头到达就会resolve    </span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 第二个await 等待的是请求响应体解析完成</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>

    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="request对象" tabindex="-1"><a class="header-anchor" href="#request对象" aria-hidden="true">#</a> Request对象</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>config<span class="token punctuation">)</span>  <span class="token comment">//实际上使用这种模式请求，fetch在内部会创建一个Request对象来完成请求。所以我们也是可以直接传入一个Request对象</span>

<span class="token keyword">const</span> req<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>url地址，配置<span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注意：尽量保证每次请求都是一个新的request对象</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="response对象" tabindex="-1"><a class="header-anchor" href="#response对象" aria-hidden="true">#</a> Response对象</h3><ul><li>ok：boolean，当响应消息码在200~299之间时为true，其他为false</li><li>status：number，响应的状态码</li><li>text（)：用于处理文本格式的Ajax响应。它从响应中获取文本流，将其读完，然后返回一个被解决为 <strong>string 对象的 Promise</strong>。</li><li>blob（)：用于处理二进制文件格式（比如图片或者电子表格）的Ajax响应。它读取文件的原始数据，一旦读取完整个文件，就返回一个被解决为<strong>blob对象的Promise</strong>。</li><li>json（）：用于处理 JSON 格式的Ajax的响应。它将 JSON 数据流转换为一个被解决为 <strong>JavaScript 对象的promise</strong>。</li><li>redirect（）：可以用于重定向到另一个 URL。它会创建一个新的Promise，以解决来自重定向的 URL 的响应。</li></ul><p>也可以手动创建一个响应体来模拟响应数据</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[{},{}]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">ok</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">200</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="headers对象" tabindex="-1"><a class="header-anchor" href="#headers对象" aria-hidden="true">#</a> Headers对象</h3><p>在Request对象内部，会将传递的请求头对象，转换为Headers对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Headers对象中的方法</p><ul><li>has（key）：检查请求头中是否存在指定的key值</li><li>get（key）：得到请求头中对应的key值</li><li>set（key，value）：修改对应的键值对</li><li>append（key，value）：添加对应的键值对，如果追加了已存在的key，值则会用逗号分隔，添加在后面</li><li>keys（）：得到所有的请求头键的集合</li><li>values（）：得到所有的请求头中的值的集合</li><li>entries（）：得到所有请求头中的键值对的集合</li></ul><h2 id="xhr和fetch对比" tabindex="-1"><a class="header-anchor" href="#xhr和fetch对比" aria-hidden="true">#</a> xhr和fetch对比</h2><ul><li>xhr是事件回调驱动、fetch是promise风格</li><li>xhr可以监听请求和响应的进度，fetch只能监听响应的进度（有兴趣的看<a href="https://juejin.cn/post/7339376488029339648?searchId=202403211130204A8EA56B8C947F64430B" target="_blank" rel="noopener noreferrer">这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）</li><li>fetch 支持可读流，适用于大文件下载</li></ul><p>基于xhr封装的库：axios</p><p>基于fetch封装的库：umi-request</p><h2 id="请求中断" tabindex="-1"><a class="header-anchor" href="#请求中断" aria-hidden="true">#</a> 请求中断</h2><p>Cancel Token 将逐步退出历史舞台，推荐使用 AbortController 来实现请求中止。</p><p><strong>axios</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// CancelToken</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>

<span class="token keyword">let</span> request <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;auth_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token <span class="token operator">=</span> token<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  config<span class="token punctuation">.</span>cancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cancel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在这里执行需要取消的逻辑，例如根据条件取消请求</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cancel</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//返回配置的对象</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//========方法2</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建取消令牌</span>
<span class="token keyword">const</span> cancelTokenSource <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发起请求</span>
axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cancelToken</span><span class="token operator">:</span> cancelTokenSource<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理响应</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Request canceled&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理其他错误</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消请求</span>
cancelTokenSource<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">&#39;Operation canceled by the user.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// AbortController</span>

<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/foo/bar&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// cancel the request</span>
controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>fetch</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 创建一个 AbortController 实例</span>
<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> signal <span class="token operator">=</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">;</span>

<span class="token comment">// 发送 Fetch 请求</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://api.example.com/data&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理响应</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理错误</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消请求</span>
controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>umi-request</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//AbortController</span>
<span class="token keyword">import</span> Request <span class="token keyword">from</span> <span class="token string">&#39;umi-request&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个控制器</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> controller<span class="token punctuation">;</span> <span class="token comment">// 返回一个 AbortSignal 对象实例，它可以用来 with/abort 一个 DOM 请求。</span>

signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;abort&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;aborted!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">Request</span><span class="token punctuation">(</span><span class="token string">&#39;/api/response_after_1_sec&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  signal<span class="token punctuation">,</span> <span class="token comment">// 这将信号和控制器与获取请求相关联然后允许我们通过调用 AbortController.abort() 中止请求</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消请求</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 中止一个尚未完成的DOM请求。这能够中止 fetch 请求，任何响应Body的消费者和流。</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// controller.signal.aborted返回true/false，判断是否已处于取消状态</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 可以通过 CancelToken.source 来创建一个 cancel token</span>
<span class="token keyword">import</span> Request <span class="token keyword">from</span> <span class="token string">&#39;umi-request&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> CancelToken <span class="token operator">=</span> Request<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> token<span class="token punctuation">,</span> cancel <span class="token punctuation">}</span> <span class="token operator">=</span> CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/cancel&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cancelToken</span><span class="token operator">:</span> token<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">thrown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Request<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Request canceled&#39;</span><span class="token punctuation">,</span> thrown<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理异常</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Request<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
  <span class="token string">&#39;/api/cancel&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;hello world&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">cancelToken</span><span class="token operator">:</span> token<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消请求(参数为非必填)</span>
<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">&#39;Operation canceled by the user.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//也可以通过实例化 CancelToken 来创建一个 token，同时通过传入函数来获取取消方法</span>
<span class="token keyword">import</span> Request <span class="token keyword">from</span> <span class="token string">&#39;umi-request&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> CancelToken <span class="token operator">=</span> Request<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">let</span> cancel<span class="token punctuation">;</span>

Request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/cancel&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cancelToken</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 取消请求</span>
<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文件上传" tabindex="-1"><a class="header-anchor" href="#文件上传" aria-hidden="true">#</a> 文件上传</h2><p>文件上传的本质仍然是一个数据提交，无非就是数据量大一些而已，http协议中文件上传默认使用下面的<strong>消息格式</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token constant">POST</span> 上传地址 <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
其他请求头
Content<span class="token operator">-</span>Type<span class="token operator">:</span> multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">;</span> boundary<span class="token operator">=</span><span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundary7MA4YWxkTrZu0gW    <span class="token comment">//boundary随机生成的定界符,用于分隔</span>

<span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundary7MA4YWxkTrZu0gW
Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">&quot;avatar&quot;</span><span class="token punctuation">;</span> filename<span class="token operator">=</span><span class="token string">&quot;小v仙女.jpg&quot;</span>&quot;   <span class="token comment">//文件提交的name字段由服务端决定</span>
Content<span class="token operator">-</span>Type<span class="token operator">:</span> image<span class="token operator">/</span>jpeg
（文件二进制数据）

<span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundary7MA4YWxkTrZu0gW
Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span>  <span class="token comment">//name是键</span>

admin   <span class="token comment">//此处是键值</span>
<span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundary7MA4YWxkTrZu0gW
Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span>

<span class="token number">123123</span>
<span class="token operator">--</span><span class="token operator">--</span>WebKitFormBoundary7MA4YWxkTrZu0gW
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>流程：</p><ol><li>客户端将文件数据发送给服务器</li><li>服务器保存上传的文件数据</li><li>服务器响应给客户端一个文件访问地址</li></ol><p>表单格式：<strong>multipart/form-data</strong></p><p>请求体中必须包含一个键值对，键的名称是服务器要求的名称，值是文件数据</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> formData<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>；<span class="token comment">//构建请求体</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;imagefile&quot;</span><span class="token punctuation">,</span>inp<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">//键名就看服务端要求,键值二进制文件数据</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;loginId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abd&quot;</span><span class="token punctuation">)</span>   <span class="token comment">//还可添加其他数据</span>
<span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span>formData<span class="token punctuation">,</span><span class="token comment">//会自动修改请求头的content-type</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文件下载" tabindex="-1"><a class="header-anchor" href="#文件下载" aria-hidden="true">#</a> 文件下载</h2><p>服务器只要在<strong>响应头中</strong>加入**Content-Disposition：attachment；filename=&#39;xxx&#39;**即可触发浏览器的下载功能</p><ul><li>atachment 表示附件，浏览器看到此字段，触发下载行为（不同的浏览器下载行为有所区别）</li><li>filename=&quot;xxx&quot;,这是告诉浏览器，保存文件时使用的默认文件名</li></ul><p>或者可能传二进制数据</p><h2 id="断点续传" tabindex="-1"><a class="header-anchor" href="#断点续传" aria-hidden="true">#</a> 断点续传</h2><p><strong>下载：</strong></p><p>若要实现下载时的断点续传，首先服务器在响应时需要在响应头加入以下字段</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Accept-Ranges: byte
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个字段是向客户端表明：我这个文件可以支持传输部分数据，你只需要告诉我你需要的是哪一部分的数据即可，单位是字节</p><p>客户端在请求时，就需要在请求头加入下面字段</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>range: bytes=0-5000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>客户端告诉服务器：请给我传递0-5000字节范围内的数据即可，无须传输全部数据</p><p>前端网页基本实现不了断点下载，因为网页上无法保存临时文件再把它合并成一个完整的文件</p><p><strong>上传：</strong></p><p>流程：</p><ol><li>用户选择文件，将文件分割为多个分片，得到文件的md5和每个分片的md5</li><li>发送文件MD5、后缀、分片顺序、每个分片MD5给服务端，服务端检查是否已上传或还有哪些部分没上传，响应需要上传的md5</li><li>客户端上传一个分片，然后重复检查上传这个步骤，直到所有分片上传完成，服务端合并文件，返回文件的访问地址</li></ol><p>https://juejin.cn/post/7241078623553175611?searchId=202403111607383172F09D8D72F128F975</p><p>https://dev-pro.cn/Node/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/6488161a9496/</p><p>视频流：https://dev-pro.cn/Node/%E8%A7%86%E9%A2%91%E6%B5%81/afe730ceeac8/</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">splitFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//分片尺寸（1M）</span>
        <span class="token keyword">const</span> chunkSize <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
        <span class="token comment">//分片数量</span>
        <span class="token keyword">const</span> chunkCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>size <span class="token operator">/</span> chunkSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当前chunk的下标</span>
        <span class="token keyword">let</span> chunkIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">//使用第三方库sparkMD5.arrayBuffer完成文件MD5编码</span>
        <span class="token keyword">const</span> spark <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparkMD5<span class="token punctuation">.</span>ArrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文件读取器</span>
        <span class="token keyword">const</span> chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//分片信息数组</span>


        <span class="token comment">//读取下一个分片</span>
        <span class="token keyword">function</span> <span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> start <span class="token operator">=</span> chunkIndex <span class="token operator">*</span> chunkSize<span class="token punctuation">,</span>
                end <span class="token operator">=</span> start <span class="token operator">+</span> chunkSize <span class="token operator">&gt;=</span> file<span class="token punctuation">.</span>size <span class="token operator">?</span> file<span class="token punctuation">.</span>size <span class="token operator">:</span> start <span class="token operator">+</span> chunkSize<span class="token punctuation">;</span>
            fileReader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//读取一个分片后的回调</span>
        fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            spark<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//分片数据追加到MD5编码器中</span>
            <span class="token comment">//当前分片单独的MD5</span>
            <span class="token keyword">const</span> chunkMD5 <span class="token operator">=</span> SparkMD5<span class="token punctuation">.</span>ArrayBuffer<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token operator">+</span> chunkIndex<span class="token punctuation">;</span>
            chunkIndex<span class="token operator">++</span><span class="token punctuation">;</span>
            chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">id</span><span class="token operator">:</span> chunkMD5<span class="token punctuation">,</span>
                <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>chunkIndex <span class="token operator">&lt;</span> chunkCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//继续读取下一个分片</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//读取完成,调用end后获取整个文件的md5</span>
                <span class="token keyword">const</span> fileId <span class="token operator">=</span> spark<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    fileId<span class="token punctuation">,</span>
                    <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    chunks
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token comment">//获取后缀</span>
        <span class="token keyword">function</span> <span class="token function">extname</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> i <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> filename<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="浏览器输入url后" tabindex="-1"><a class="header-anchor" href="#浏览器输入url后" aria-hidden="true">#</a> 浏览器输入url后</h2><p>检查url是否合法，是否需要进行编码，</p><p>通过<strong>DNS解析</strong>找到服务器的IP地址，检查是否命中强缓存或协商缓存</p><p><strong>建立tcp连接</strong>通道，浏览器<strong>发送请求</strong>，服务端<strong>响应相应的静态文件</strong>，根据浏览器使用的协议版本和connection字段决定是否保留tcp连接</p><p>开始<strong>解析html文件</strong>，解析过程中可能会加载js、css文件资源</p><p>解析过程中<strong>构建DOM树</strong>、<strong>CSSOM树</strong>，然后一边生成，一边把二者<strong>合并为渲染树</strong>（rendering tree），随后对渲染树中的每个节点计算位置和大小（reflow），最 后把每个节点利用GPU<strong>绘制到屏幕</strong>（repaint）</p><h2 id="http缓存" tabindex="-1"><a class="header-anchor" href="#http缓存" aria-hidden="true">#</a> http缓存</h2><p>**注意：**强缓存和协商缓存都只能作用于get请求</p><h3 id="强缓存" tabindex="-1"><a class="header-anchor" href="#强缓存" aria-hidden="true">#</a> 强缓存</h3><p>在浏览器中，强缓存分为<strong>Expires</strong>（http1.0规范）、<strong>cache-control</strong>（http1.1规范）两种。</p><p>这两个字段都是在<strong>响应头</strong>中出现,cache-control优先级比expires高，会直接覆盖，无论expires是否过期</p><p><strong>Expires:</strong></p><p>格式为GMT时间，本机时间和该时间对比，在这时间之前都表示使用缓存，不会重新请求</p><p>缺点是由于本机时间可以更改，所以并不太好</p><p><strong>Cache-Control：</strong></p><ul><li>max-age：资源缓存时间，3600表示1小时过期，配合响应头的Date字段</li><li>no-store：告诉浏览器不要对此资源做任何缓存</li><li>no-cache：并不是不缓存，而是再次请求询问服务器是否可以使用该缓存。但是每次都需要向服务器校验缓存的有效性</li></ul><p>在http1.0规范时还有一个<strong>Pragma</strong>缓存策略，那时候Cache-control（http1.1）还没出，它与Cache-Control: no-cache 效果一致。强制要求缓存服务器在返回缓存之前将请求提交到源头服务器进行验证</p><h3 id="协商缓存" tabindex="-1"><a class="header-anchor" href="#协商缓存" aria-hidden="true">#</a> 协商缓存</h3><p>与 强缓存不同的是，强缓存 是在时效时间内，不走服务端，只走本地缓存；而协商缓存是要走服务端的，如果请求某个资源，去请求服务端时，发现 命中缓存则返回 304，否则则返回所请求的资源</p><p><strong>Last-Modified，If-Modified-Since</strong></p><ul><li>第一次请求资源时，<strong>服务端</strong>会把所请求的<strong>资源的最后一次修改时间</strong>当成<strong>响应头</strong>中<strong>Last-Modified</strong>的值发到浏览器并在浏览器存起来</li><li>第二次请求资源时，<strong>浏览器</strong>会把<strong>刚刚存储的时间当成请求头中 If-Modified-Since 的值</strong>，传到服务端，服务端拿到这个时间跟所请求的资源的最后修改时间进行对比</li><li>如果两个时间相同，则说明此资源没修改过，那就是命中缓存，那就返回 304，如果不相同，则说明此资源修改过了，则没命中缓存，则返回修改过后的新资源</li></ul><p><strong>Etag，If-None-Match</strong></p><p>和last-modified同时存在时，Etag优先级高且会覆盖</p><p>其实 Etag，If-None-Match 跟 Last-Modified，If-Modified-Since 大体一样，区别在于</p><ul><li>Last-Modified是对比资源最后一次修改时间</li><li>Etag是对比资源内容，Etag是资源内容产生的hash</li></ul><p><strong>状态码区别</strong></p><ul><li>200请求成功，服务器返回全新的数据</li><li>200 from memory cache／ from disk cache 本地强缓存还在有效期，直接使用本地缓存</li><li>304 请求成功，走了协商缓存，服务器判定（Etag 和Last-modified）没有过期，告知浏览器使用缓存</li></ul><h2 id="csrf攻击" tabindex="-1"><a class="header-anchor" href="#csrf攻击" aria-hidden="true">#</a> CSRF攻击</h2><p>跨站请求伪造</p><p>只要访问那些恶意网站，通过img或者script，就自动把请求给发送出去，因为cookie是自动发送的，所以用户身份就被盗用了</p><p><strong>防御方式：</strong></p><p>不使用cookie（服务端渲染难以抛弃cookie）</p><p>CSRF Token，即做重要的操作前，就发送一个一次性的验证token给客户端，客户端发送相应操作的请求时携带这个token，服务端验证后就知道这是从我的网站发起的请求</p><p>referer防护，请求头的Referer字段表示请求来源，过去就直接通过该字段判断此请求是否安全。(也不安全)</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code>// 下面请求就会没有referer字段
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>data:text/html;base64,经过base64编码转换后的请求代码<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="xss攻击" tabindex="-1"><a class="header-anchor" href="#xss攻击" aria-hidden="true">#</a> XSS攻击</h2><p>跨站脚本攻击，是指攻击者利用站点的漏洞，在表单提交时，在表单内容中加入一些恶意脚本，当其他正常用户浏览页面，而页面中刚好出现攻击者的恶意脚本时，脚本被执行，从而使得页面遭到破坏，或者用户信息被窃取。</p><p><strong>防御方式：</strong></p><p>服务端对用户提交的内容进行过滤或编码</p><ul><li>过滤：去掉一些危险的标签或属性</li><li>编码：对危险的标签进行html实体编码</li></ul><p>防盗链Referer</p><h2 id="网络性能优化" tabindex="-1"><a class="header-anchor" href="#网络性能优化" aria-hidden="true">#</a> 网络性能优化</h2><ul><li>优化打包体积：利用打包工具进行压缩</li><li>压缩：服务端的文件压缩后再响应给客户端，只要解压时间小于优化的传输时间</li><li>CDN：利用CDN可以大幅缩减静态资源的访问时间，特别是对于公共库的访问，可以使用知名的CDN资源，这样可以实现跨越站点的缓存</li><li>缓存：对于除HTML外的所有静态资源均可以开启协商缓存，利用构建工具打包产生的文件hash值来置换缓存</li><li>http2：开启http2后，利用其多路复用、头部压缩等特点，充分利用带宽传递大量的文件数据</li><li>雪碧图：对于不使用HTTP2的场景，可以将多个图片合并为雪碧图，以达到减少文件的目的</li><li>多个静态资源域：对于不使用HTTP2的场景，将相对独立的静态资源分到多个域中保存，可以让浏览器同时开启多个TCP连接（最多6个），并行下载</li></ul><h2 id="ssl、tls、https的关系" tabindex="-1"><a class="header-anchor" href="#ssl、tls、https的关系" aria-hidden="true">#</a> SSL、TLS、HTTPS的关系</h2><p>SSL（SecureSocketsLayer），安全套接字协议</p><p>TLS（TransportLayerSecurity），传输层安全性协议</p><p>TLS是SSL的升级版，两者几乎是一样的</p><p>HTTPS (Hyper Text Transfer Protocol over SecureSocket）<strong>SSL协议之上的HTTP协议</strong></p><p>需要CA：证书颁发机构做中间人，做信息担保，不然怎么加密传输都不安全</p><p><strong>证书颁发流程</strong>：</p><p>向机构花钱<strong>购买证书</strong>（也有免费的，有一定时限），同时把你自己的<strong>服务器公钥</strong>也交给机构，<strong>机构有它的公钥和私钥</strong>。机构通过它自己的私钥，对你的服务器公钥进行加密，形成证书</p><p><strong>证书内容：</strong></p><ul><li>绑定的域名</li><li>颁发证书的机构</li><li>服务器公钥（由机构的私钥加密你的<strong>服务器公钥</strong>产生，<strong>客户端</strong>可通过机构的公钥可以解密）</li><li>证书签名（证书签名=<strong>域名+CA公钥+服务器公钥</strong>，然后<strong>通过CA的私钥加密</strong>（机构的公钥可以解密，<strong>客户端</strong>此时就可以对比CA公钥是否一致））</li></ul><p>证书签名的算法是公开的，是为了让每一个拿到证书的终端，可以验证签名是否被篡改。</p><p>其他终端只能通过CA的公钥解密读取，但又没办法重新加密，自己加密再发回客户端的话，客户端用CA公钥一解发现出错就知道被篡改了</p><p><strong>https握手流程：</strong></p><ol><li>客户端想要向服务端发起https请求，服务端返回证书</li><li>客户端<strong>验证证书里的域名</strong>（和我准备请求的是否一致），<strong>查看颁发证书的机构</strong>是否权威（是否浏览器支持），通过CA的公钥解密拿到<strong>服务器的公钥</strong>，<strong>解密签名</strong>查看域名、CA公钥、服务器公钥是否对的上</li><li>对应上了，那就用<strong>服务器公钥</strong>来加密一个对称密钥（后面就用这个密钥来相互传递），这个对称密钥也<strong>只有服务器私钥能解密</strong></li></ol><h2 id="tcp的三次握手、四次挥手" tabindex="-1"><a class="header-anchor" href="#tcp的三次握手、四次挥手" aria-hidden="true">#</a> TCP的三次握手、四次挥手</h2><p>TCP协议是传输层的一个面向连接的安全可靠的传输协议，三次握手是为了建立一个安全可靠的连接</p><p>报文格式：</p><p><img src="/xjblog/assets/image-20240315131346738-93e54d1b.png" alt="image-20240315131346738"></p><ul><li><p>序列号seq（标识报文的序号）、</p></li><li><p>确认序号ack 32位、</p></li><li><p>同步标志位SYN、终止标志位FIN</p></li><li><p>确认标志位ACK 1位</p></li></ul><p><strong>第一次握手</strong>：</p><p><strong>客户端</strong>向服务端<strong>发送SYN包</strong>（数据报文），请求连接。</p><p>SYN＝１，一个随机生成的ｓｅｑ＝ｘ（３２位的序列号）</p><p><strong>第二次握手：</strong></p><p><strong>服务端</strong>收到了SYN包，确认客户端的数据包后，<strong>发送SYN+ACK数据包</strong>。</p><p>SYN=1、ACK=1、ｓｅｑ＝ｙ、ａｃｋ＝ｘ＋１</p><p><strong>第三次握手：</strong></p><p><strong>客户端</strong>收到了SYN＋ACK，<strong>再次发送确认包ａｃｋ</strong>给服务器，服务器验证没问题就进入连接状态</p><p>ACK＝１、ｓｅｑ＝ｘ＋１、ａｃｋ＝ｙ＋１</p><p><img src="/xjblog/assets/image-20240315131937018-42ff84c9.png" alt="image-20240315131937018"></p><p><strong>为什么一定是三次握手而不是两次或四次？</strong></p><p>第一次握手就是我告诉你要连接，第二次握手是表示我知道你要连接我，第三次握手是我知道-你知道我要连接你。</p><p>如果只有两次就确定连接状态，那在服务端传输过程中丢包或者传输时间过长，那客户端有可能会重新发起连接请求，而早就不需要之前的那次连接，服务器紫优就浪费了。</p><p>如果握手过多又套娃浪费时间</p><p>如果第三次握手丢包了，服务端会进行重传5次，可以设置，如果仍得不到应答就会发送RST报文，并关闭连接</p><p><strong>第一次挥手：</strong></p><p><strong>客户端</strong>发送一个<strong>FIN</strong>，请求关闭与服务端的连接。</p><p>FIN＝１，ｓｅｑ＝ａ，ａ大于当初生成的ｘ，因为ａ是在发报文的过程中从ｘ增长上来的</p><p><strong>第二次挥手：</strong></p><p><strong>服务器</strong>收到这个FIN，发送<strong>ACK</strong>给客户端，告诉它我已经收到了，但我未必已经准备好断开，等我后面准备好了告诉你</p><p>ACK＝１、ａｃｋ＝ａ＋１</p><p><strong>第三次挥手：</strong></p><p>等<strong>服务端</strong>所有的东西都发送完了，准备好了，就发送一个<strong>FIN</strong>给客户端</p><p>FIN＝１、ｓｅｑ＝ｂ，ｂ》ｙ，理由同ａ》ｘ</p><p><strong>第四次挥手：</strong></p><p><strong>客户端</strong>收到FIN，发回一个<strong>ACK</strong>确认，告诉服务端我收到了，并进入TIME_WAIT状态。等待2MSL后自动关闭</p><p>ACK＝１、ａｃｋ＝ｂ＋１</p><p><img src="/xjblog/assets/image-20240315133230315-ee279e3a.png" alt="image-20240315133230315"></p><p><strong>为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？</strong></p><p>我们必须假象网络是不可靠的，有可能最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。服务端如果没有收到最后的ACK，将不断重复发送FIN片段。所以客户端不能立即关闭，它必须确认服务端接收到了该ACK。</p><p>Client会在发送出ACK之后进入到TIME_WAIT状态。Client会设置一个计时器，等待2MSL的时间。如果在该时间内再次收到FIN，那么Client会重发ACK并再次等待2MSL。所谓的2MSL是两倍的MSL(Maximum Segment Lifetime)。</p><p>MSL指一个片段在网络中最大的存活时间，2MSL就是一个发送和一个回复所需的最大时间。如果直到2MSL，Client都没有再次收到FIN，那么Client推断ACK已经被成功接收，则结束TCP连接。</p><p><strong>为什么二三次挥手不能合并成一次？</strong></p><p>因为客户端发送FIN要求断开连接，说明后面不会再发请求，而服务端并不能保证还不发送数据给客户端</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/xjblog/more/部署nuxt项目.md" class="" aria-label="部署nuxt项目"><!--[--><!--]--> 部署nuxt项目 <!--[--><!--]--></a></span><span class="next"><a href="/xjblog/more/git.html" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/xjblog/assets/app-c984cf19.js" defer></script>
  </body>
</html>
